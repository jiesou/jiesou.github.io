<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jiecs"><meta name="keywords" content=""><meta name="description" content="前言我的博客之前一直是部署在 Vercel 上的，虽然 Vercel 对 SLA 有四个 9 的保证。但出于折腾的心态我还是想给博客上个冗余。我的博客可以同时托管在多个平台上（如 Netlify），然后在监控到博客异常时自动切换 监控平台选择监控平台有很多，经过斟酌我博客选择的是 BetterUptime，免费能 3 分钟一次，附有 StatusPage，界面也比较好看 不过 BetterUpti"><meta property="og:type" content="article"><meta property="og:title" content="零成本的博客高可用多冗余方案"><meta property="og:url" content="https://www.jiecs.top/archives/1771d434/index.html"><meta property="og:site_name" content="杰出兽的小宇宙"><meta property="og:description" content="前言我的博客之前一直是部署在 Vercel 上的，虽然 Vercel 对 SLA 有四个 9 的保证。但出于折腾的心态我还是想给博客上个冗余。我的博客可以同时托管在多个平台上（如 Netlify），然后在监控到博客异常时自动切换 监控平台选择监控平台有很多，经过斟酌我博客选择的是 BetterUptime，免费能 3 分钟一次，附有 StatusPage，界面也比较好看 不过 BetterUpti"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jiecs.top/img/2022/11/cover_%E9%9B%B6%E6%88%90%E6%9C%AC%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%AB%98%E5%8F%AF%E7%94%A8%E5%A4%9A%E5%86%97%E4%BD%99%E6%96%B9%E6%A1%88.webp"><meta property="article:published_time" content="2022-11-24T17:11:52.000Z"><meta property="article:modified_time" content="2025-10-23T08:27:50.438Z"><meta property="article:author" content="Jiecs"><meta property="article:tag" content="博客"><meta property="article:tag" content="技术"><meta property="article:tag" content="教程"><meta property="article:tag" content="云服务"><meta property="article:tag" content="JavaScript"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jiecs.top/img/2022/11/cover_%E9%9B%B6%E6%88%90%E6%9C%AC%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%AB%98%E5%8F%AF%E7%94%A8%E5%A4%9A%E5%86%97%E4%BD%99%E6%96%B9%E6%A1%88.webp"><title>零成本的博客高可用多冗余方案 - 杰出兽的小宇宙</title><link rel="stylesheet" href="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/hint.css@2.7.0/hint.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"www.jiecs.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["home"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body><style>footer{position:relative}.iframe-overlay,iframe[loading=lazy]{position:absolute;height:245px;width:300px;transform:scale(.9) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem);bottom:-80px;left:0;z-index:3;transition:transform .3s ease,clip-path .3s ease}.iframe-overlay{z-index:4;background:0 0;cursor:pointer;display:none}iframe[loading=lazy].expanded+.iframe-overlay{display:none}iframe[loading=lazy].expanded{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 0 0 0 round 1.2rem)}:root[data-user-color-scheme=light] iframe[loading=lazy]{filter:invert(1) hue-rotate(-200deg)}@media (max-width:1700px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 120px 0 round 1.2rem);transform:scale(.64)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem)}.iframe-overlay{display:block}}@media (max-width:768px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 163px 0 round 1.2rem);bottom:-25px;transform:scale(.5) scaleY(.93);left:calc(50% - 150px)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}iframe[loading=lazy].expanded{transform:scale(.8) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}}</style><script>document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector("footer"),t=document.createElement("iframe");t.frameBorder=0,t.src="https://support.nodeget.com/page/promotion?id=334%20|%20jiesou",t.loading="lazy";const n=document.createElement("div");n.className="iframe-overlay",n.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("expanded")})),e.appendChild(t),e.appendChild(n),document.addEventListener("click",(function(e){t.contains(e.target)||t.classList.remove("expanded")}))}))</script><header><div class="header-inner" style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>杰出兽的小宇宙</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/%E5%8A%A8%E6%80%81/" target="_self"><i class="iconfont icon-comment"></i> <span>动态</span></a></li><li class="nav-item"><a class="nav-link" href="/projects/" target="_self"><i class="iconfont icon-code"></i> <span>项目</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-link-fill"></i> <span>友链</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="https://www.alongw.cn" target="_self"><span>阿龙博客</span></a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" false style="background:url(https://cdn.jiecs.top/img/2022/11/cover_零成本的博客高可用多冗余方案.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">零成本的博客高可用多冗余方案</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-11-24 17:11" pubdate>2022年11月24日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.4k 字</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">零成本的博客高可用多冗余方案</h1><div class="markdown-body"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我的博客之前一直是部署在 <a target="_blank" rel="noopener" href="https://vercel.com/">Vercel</a> 上的，虽然 Vercel 对 SLA 有<a target="_blank" rel="noopener" href="https://vercel.com/legal/sla">四个 9</a> 的保证。但出于折腾的心态我还是想给博客上个冗余。我的博客可以同时托管在多个平台上（如 <a target="_blank" rel="noopener" href="https://netlify.com/">Netlify</a>），然后在监控到博客异常时自动切换</p><h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><h3 id="平台选择"><a href="#平台选择" class="headerlink" title="平台选择"></a>平台选择</h3><p>监控平台有很多，经过斟酌我博客选择的是 <a target="_blank" rel="noopener" href="https://betteruptime.com/">BetterUptime</a>，免费能 3 分钟一次，附有 StatusPage，界面也比较好看</p><p>不过 BetterUptime 免费是没法设置 WebHook 的，你就没法对事件设置更多自己的操作。但我注意到它支持 Zapier 能设置自己的自定义操作。<a target="_blank" rel="noopener" href="https://zapier.com/">Zapier</a> 是一个类似 IFTTT 的平台，更面向企业等。然而很坑的是 Zapier 免费计划照样不支持 WebHook</p><h3 id="Zapier-转发-IFTTT-来执行-WebHook"><a href="#Zapier-转发-IFTTT-来执行-WebHook" class="headerlink" title="Zapier 转发 IFTTT 来执行 WebHook"></a>Zapier 转发 IFTTT 来执行 WebHook</h3><p>总之经过各种摸索，我发现只要 Zapier 能设置通过自己的电子邮箱（授权 Gmail 等）向指定邮箱地址，发出事件的详细邮件消息。你可以在里面设置自己的格式</p><p>并且 <a target="_blank" rel="noopener" href="https://ifttt.com/">IFTTT</a> 支持接收来自指定电子邮箱的邮件，<strong>这就能将 Zapier 触发的内容转发到 IFTTT</strong>。你就可以用 IFTTT 进行更多自定义操作，<strong>其中包括 WebHook</strong></p><p>于是我在 Zapier 上弄出了这个自动化流程：</p><p><img src="https://cdn.jiecs.top/img/2022/11/IMG_20221124_223022.webp" srcset="/img/loading.gif" lazyload alt="Zapier 配置"></p><p>其中 <em><a href="mailto:&#116;&#114;&#x69;&#103;&#x67;&#x65;&#x72;&#x40;&#x61;&#x70;&#x70;&#x6c;&#101;&#x74;&#x2e;&#105;&#102;&#116;&#x74;&#116;&#46;&#99;&#x6f;&#x6d;">trigger@applet.ifttt.com</a></em> 正是 IFTTT 的邮件接受目标地址。然后在 IFTTT 进行相应配置即可：</p><p><img src="https://cdn.jiecs.top/img/2022/11/Screenshot_2022-11-24-18-12-49-185_com.microsoft.emmx.webp" srcset="/img/loading.gif" lazyload alt="IFTTT 配置"></p><p>IFTTT 的接受邮件触发器可以参考这个<a target="_blank" rel="noopener" href="https://ifttt.com/email/triggers/send_ifttt_an_email">文档</a></p><p>IFTTT 的 WebHook 支持各种请求方式，也能通过 body 等方式传递数据。监控侧解决了，就可以将异常信息传递到自己的 API 了，下一步就是自己实现处理异常的 API</p><h2 id="回调-API-实现"><a href="#回调-API-实现" class="headerlink" title="回调 API 实现"></a>回调 API 实现</h2><h3 id="托管平台选择"><a href="#托管平台选择" class="headerlink" title="托管平台选择"></a>托管平台选择</h3><p>API 我本来是打算托管在 <a target="_blank" rel="noopener" href="https://workers.dev/">Cloudflare Workers</a> 的。但它的命令行工具 Wrangler CLI 实在太难用了，主要是这个<a target="_blank" rel="noopener" href="https://github.com/cloudflare/wrangler2/issues/1732">问题</a>让我基本没法在安卓上开发。我也懒得折腾那么多问题，不如直接换个平台</p><p>我最终选择的是 <a target="_blank" rel="noopener" href="https://deta.sh/">Deta.sh</a>，它宣称永远提供免费无限量的 Node.js&#x2F;Python Web 应用请求。虽然相比之下好像没那么靠谱（也没提供 SLA 保证），但综合之下只能选它了</p><p>Deta 的 CLI 还是很好用的。就是本地调试麻烦点，我是用自己的 <code>nodemon</code></p><h3 id="冗余的切换"><a href="#冗余的切换" class="headerlink" title="冗余的切换"></a>冗余的切换</h3><p>要实现高可用，最关键的肯定就是切换冗余。切换镜像网站最直接的方法就是换 DNS 解析。</p><p>我域名用的是阿里云 DNS，他提供了一整套易用免费 DNS 处理的 OpenAPI 以及各语言 SDK。文档在<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/29771.html">此处</a>，还有一个很好用的 <a target="_blank" rel="noopener" href="https://next.api.aliyun.com/api/Alidns/?lang=NODEJS">在线 API 调试工具</a>（就是移动端体验不咋滴）。API 的密钥是 AccessKey，参考<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/116401.html">文档</a>来创建</p><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><p>最后，以下是我在 Deta 上部署的完整代码，API 密钥等使用了环境变量，部分内容已隐去，依赖都在开头</p><p>代码仅供参考，具体还是根据你的需求写</p><details><summary>展开完整代码</summary><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)<br><span class="hljs-keyword">const</span> &#123;<span class="hljs-attr">default</span>: fetch&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;node-fetch-cjs&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Core</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@alicloud/pop-core&#x27;</span>);<br><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dotenv&#x27;</span>).<span class="hljs-title function_">config</span>()<br><br><span class="hljs-keyword">let</span> app = <span class="hljs-title function_">express</span>();<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">formatDate</span> = (<span class="hljs-params">date</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date)<br>    .<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">&quot;zh&quot;</span>,&#123;<br>      <span class="hljs-attr">timeZone</span>: <span class="hljs-string">&quot;Asia/Shanghai&quot;</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendTgMsg</span>(<span class="hljs-params">incident, result</span>) &#123;<br>  <span class="hljs-keyword">const</span> startedTime = (incident[<span class="hljs-string">&#x27;started_at&#x27;</span>]) ? <span class="hljs-string">`</span><br><span class="hljs-string">*开始时间：*<span class="hljs-subst">$&#123;formatDate(incident[<span class="hljs-string">&#x27;started_at&#x27;</span>])&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">const</span> acknowledgedTime = (incident[<span class="hljs-string">&#x27;acknowledged_at&#x27;</span>]) ? <span class="hljs-string">`</span><br><span class="hljs-string">*承认时间：*<span class="hljs-subst">$&#123;formatDate(incident[<span class="hljs-string">&#x27;acknowledged_at&#x27;</span>])&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">const</span> resolvedTime = (incident[<span class="hljs-string">&#x27;resolved_at&#x27;</span>]) ? <span class="hljs-string">`</span><br><span class="hljs-string">*解决时间：*<span class="hljs-subst">$&#123;formatDate(incident[<span class="hljs-string">&#x27;resolved_at&#x27;</span>])&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">const</span> status = (incident.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;started&#x27;</span>) ? <span class="hljs-string">&#x27;⚠️&#x27;</span> : ((incident.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;resolved&#x27;</span>) ? <span class="hljs-string">&#x27;✅&#x27;</span> : <span class="hljs-string">&#x27;☑️&#x27;</span>);<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.telegram.org/<span class="hljs-subst">$&#123;process.env.TELEGRAM_TOKEN&#125;</span>/sendMessage`</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>    <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span> &#125;,<br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>      <span class="hljs-string">&quot;disable_web_page_preview&quot;</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-string">&quot;parse_mode&quot;</span>: <span class="hljs-string">&quot;Markdown&quot;</span>,<br>      <span class="hljs-string">&quot;chat_id&quot;</span>: <span class="hljs-number">968510652</span>,<br>      <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">`*<span class="hljs-subst">$&#123;status&#125;</span> 监控到 杰出兽 服务状态变更*</span><br><span class="hljs-string"></span><br><span class="hljs-string">_<span class="hljs-subst">$&#123;incident.title&#125;</span>_：</span><br><span class="hljs-string">*状态：* <span class="hljs-subst">$&#123;incident.status&#125;</span><span class="hljs-subst">$&#123;startedTime&#125;</span><span class="hljs-subst">$&#123;acknowledgedTime&#125;</span><span class="hljs-subst">$&#123;resolvedTime&#125;</span></span><br><span class="hljs-string">*原因：*_<span class="hljs-subst">$&#123;incident.cause&#125;</span>_</span><br><span class="hljs-string">*详情：*<span class="hljs-subst">$&#123;incident[<span class="hljs-string">&#x27;incident_url&#x27;</span>]&#125;</span></span><br><span class="hljs-string">*DNS 处置：*<span class="hljs-subst">$&#123;result || <span class="hljs-string">&#x27;无&#x27;</span>&#125;</span></span><br><span class="hljs-string">`</span>&#125;)<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-title function_">async</span> (_error) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendTgMsg</span>(incident, result);<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">aliyunDnsRecordIds</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">request</span>(<span class="hljs-string">&#x27;DescribeDomainRecords&#x27;</span>, &#123;<br>      <span class="hljs-string">&quot;DomainName&quot;</span>: <span class="hljs-string">&quot;jiecs.top&quot;</span>,<br>      <span class="hljs-string">&quot;RRKeyWord&quot;</span>: <span class="hljs-string">&quot;www&quot;</span><br>  &#125;, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">formatParams</span>: <span class="hljs-literal">false</span><br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)<br>    <span class="hljs-keyword">return</span> [];<br>  &#125;);<br>  <span class="hljs-keyword">return</span> result.<span class="hljs-property">DomainRecords</span>.<span class="hljs-property">Record</span>;<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">aliyunDnsSwitch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> records = <span class="hljs-keyword">await</span> <span class="hljs-title function_">aliyunDnsRecordIds</span>();<br>  <span class="hljs-keyword">const</span> results = [];<br>  <span class="hljs-keyword">const</span> replaced = records[<span class="hljs-number">0</span>].<span class="hljs-property">Value</span> === process.<span class="hljs-property">env</span>.<span class="hljs-property">ALIYUN_DNS_REPLACE_WITH</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> index <span class="hljs-keyword">in</span> records) &#123;<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">request</span>(<span class="hljs-string">&#x27;UpdateDomainRecord&#x27;</span>, &#123;<br>      <span class="hljs-string">&quot;RecordId&quot;</span>: records[index].<span class="hljs-property">RecordId</span>,<br>      <span class="hljs-string">&quot;Line&quot;</span>: records[index].<span class="hljs-property">Line</span>,<br>      <span class="hljs-string">&quot;RR&quot;</span>: <span class="hljs-string">&quot;www&quot;</span>,<br>      <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;CNAME&quot;</span>,<br>      <span class="hljs-string">&quot;Value&quot;</span>: (replaced) ?<br>        ((records[index].<span class="hljs-property">Line</span> === <span class="hljs-string">&#x27;default&#x27;</span>) ? <span class="hljs-string">&#x27;[DEFAULT_LINE_DNS_CNAME]&#x27;</span> : <span class="hljs-string">&#x27;[OTHER_LINES_DNS_CNAME]&#x27;</span>) :<br>          process.<span class="hljs-property">env</span>.<span class="hljs-property">ALIYUN_DNS_REPLACE_WITH</span><br>    &#125;, &#123;<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>      <span class="hljs-attr">formatParams</span>: <span class="hljs-literal">false</span><br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      results.<span class="hljs-title function_">push</span>(error.<span class="hljs-property">data</span>.<span class="hljs-property">Message</span>);<br>    &#125;);<br>    (result) ? results.<span class="hljs-title function_">push</span>(result) : <span class="hljs-literal">null</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(results);<br>&#125;<br><br><span class="hljs-keyword">let</span> client;<br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/[API_PATH]&#x27;</span>, <span class="hljs-title function_">async</span> (req, res) =&gt; &#123;<br>    client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Core</span>(&#123;<br>      <span class="hljs-attr">accessKeyId</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ALIYUN_AK_ID</span>,<br>      <span class="hljs-attr">accessKeySecret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ALIYUN_AK_SECRET</span>,<br>      <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;https://alidns.ap-southeast-1.aliyuncs.com&#x27;</span>,<br>      <span class="hljs-comment">// 新加坡服务器</span><br>      <span class="hljs-attr">apiVersion</span>: <span class="hljs-string">&#x27;2015-01-09&#x27;</span><br>    &#125;);<br>    <span class="hljs-keyword">const</span> incident = req.<span class="hljs-property">body</span>;<br>    <span class="hljs-keyword">const</span> result = (incident.<span class="hljs-property">title</span> === <span class="hljs-string">&#x27;jiecs.top&#x27;</span> &amp;&amp;<br>        incident.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;started&#x27;</span>) ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">aliyunDnsSwitch</span>() : <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendTgMsg</span>(incident, result);<br>    res.<span class="hljs-title function_">json</span>(incident);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app;<br><span class="hljs-comment">// 本地调试用</span><br><span class="hljs-keyword">const</span> port = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;<br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;Server listening on port&#x27;</span>, port);<br>&#125;);<br></code></pre></td></tr></table></figure></details><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面代码我还加了个 Telegram 的通知，参考<a target="_blank" rel="noopener" href="https://core.telegram.org/bots/api#sendmessage">文档</a></p><p>至于鉴权我直接用了一个较长和复杂的 <code>[API_PATH]</code>，毕竟个人博客用不上多么安全，再说 IFTTT 也没法进行一些复杂的处理</p><p>回顾一下，整个流程的部署都是零成本的。虽然各个平台间的数据交接增加了攻击面，但这也极大地减少了对单点异常造成的影响</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2/" class="category-chain-item">这个博客</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E5%8D%9A%E5%AE%A2/" class="print-no-link">#博客</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" class="print-no-link">#技术</a> <a href="/tags/%E6%95%99%E7%A8%8B/" class="print-no-link">#教程</a> <a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/" class="print-no-link">#云服务</a> <a href="/tags/JavaScript/" class="print-no-link">#JavaScript</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/archives/e7973ac4/" title="江泽民逝世"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">江泽民逝世</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/archives/47708b20/" title="Telegram Instant View 即时预览适配"><span class="hidden-mobile">Telegram Instant View 即时预览适配</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="/follow" target="_blank" rel="nofollow noopener"><span>Follow</span></a> | <a href="/thanks" target="_blank" rel="nofollow noopener"><span>Thanks</span></a> | <a href="/privacy-policy" target="_blank" rel="nofollow noopener"><span>Privacy</span></a> | <a href="https://jiecs-status.betteruptime.com" target="_blank" rel="nofollow noopener"><span>Status</span></a><br>Jiecs All Rights Reserved</div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2021024503号</a></span></div></div></footer><script src="https://unpkg.jiecs.top/jquery@3.6.4/dist/jquery.min.js"></script><script src="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/tocbot@4.20.1/dist/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://unpkg.jiecs.top/clipboard@2.0.11/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/anchor-js@5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="/js/resize_image.js"></script><link rel="stylesheet" href="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.css"><link rel="stylesheet" href="/css/post_custom.css"><script src="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.umd.js"></script><script src="/js/post_custom.js"></script><script>if(!/jiecs.top|localhost/.test(location.host)){/google|bing|baidu|sogou|soso|DuckDuckBot|yandex|msn/i.test(navigator.userAgent)&&(location.host="www.jiecs.top")}</script><script defer async>if(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack||"",dnt.startsWith("1")||dnt.startsWith("yes")||dnt.startsWith("on")){var footer=document.querySelector("div.footer-content");footer.innerHTML=footer.innerHTML+"<br>I don't track ;)"}else{!function(t,e,a,n,o,r,c){t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},(r=e.createElement(n)).async=1,r.src="https://www.clarity.ms/tag/83h7yd1jzh",(c=e.getElementsByTagName(n)[0]).parentNode.insertBefore(r,c)}(window,document,"clarity","script");var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e2bcbf5019e3c05e7631d4a3081b10d9";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();let t=document.createElement("script");function gtag(){dataLayer.push(arguments)}t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8QKELED2GX",document.body.appendChild(t),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8QKELED2GX")}</script><script src="/js/custom.js"></script></body></html>