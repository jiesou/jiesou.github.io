<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jiecs"><meta name="keywords" content=""><meta name="description" content="å‰è¨€ShellCrash æŒ‰è®¾è®¡èƒ½å¤Ÿåœ¨å„ç§åŸºäº&#x2F;ç±»ä¼¼ OpenWrt çš„ç³»ç»Ÿä¸Šæ–¹ä¾¿åœ°é…ç½®ç®¡ç† mihomoã€singbox ä¹‹ç±»çš„ä»£ç†å†…æ ¸ã€‚ä½†ç”±äº Merlinï¼ˆæ¢…æ—ï¼‰å›ºä»¶çš„è®¸å¤šç»„ä»¶éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼ŒShellCrash åœ¨ Merlin ä¸Šè¿è¡Œå¯èƒ½é‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚ è¿™ç¯‡æŒ‡å—åŒ…å«å¯¹ iptablesã€ShellCrashã€Dnsmasq è¿ä½œæ–¹å¼çš„è¯´æ˜ï¼Œä½¿ç”¨äº†å¾ˆå¤šå¼ºåˆ¶è¦†å†™ä¹‹ç±»çš„ hac"><meta property="og:type" content="article"><meta property="og:title" content="æ¢…æ—å›ºä»¶ä¸ ShellCrash çš„å†²çª - å…³äº iptables ä¸ Dnsmasq"><meta property="og:url" content="https://www.jiecs.top/archives/6b93c6c3/index.html"><meta property="og:site_name" content="æ°å‡ºå…½çš„å°å®‡å®™"><meta property="og:description" content="å‰è¨€ShellCrash æŒ‰è®¾è®¡èƒ½å¤Ÿåœ¨å„ç§åŸºäº&#x2F;ç±»ä¼¼ OpenWrt çš„ç³»ç»Ÿä¸Šæ–¹ä¾¿åœ°é…ç½®ç®¡ç† mihomoã€singbox ä¹‹ç±»çš„ä»£ç†å†…æ ¸ã€‚ä½†ç”±äº Merlinï¼ˆæ¢…æ—ï¼‰å›ºä»¶çš„è®¸å¤šç»„ä»¶éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼ŒShellCrash åœ¨ Merlin ä¸Šè¿è¡Œå¯èƒ½é‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚ è¿™ç¯‡æŒ‡å—åŒ…å«å¯¹ iptablesã€ShellCrashã€Dnsmasq è¿ä½œæ–¹å¼çš„è¯´æ˜ï¼Œä½¿ç”¨äº†å¾ˆå¤šå¼ºåˆ¶è¦†å†™ä¹‹ç±»çš„ hac"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jiecs.top/img/2024/08/cover_%E6%A2%85%E6%9E%97%E5%9B%BA%E4%BB%B6%E4%B8%8E_ShellCrash_%E7%9A%84%E5%86%B2%E7%AA%81%E5%85%B3%E4%BA%8E_iptables_%E4%B8%8E_Dnsmasq.webp"><meta property="article:published_time" content="2024-08-04T22:32:01.000Z"><meta property="article:modified_time" content="2026-03-01T17:03:10.352Z"><meta property="article:author" content="Jiecs"><meta property="article:tag" content="æŠ€æœ¯"><meta property="article:tag" content="æ•™ç¨‹"><meta property="article:tag" content="æ—¥å¸¸"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jiecs.top/img/2024/08/cover_%E6%A2%85%E6%9E%97%E5%9B%BA%E4%BB%B6%E4%B8%8E_ShellCrash_%E7%9A%84%E5%86%B2%E7%AA%81%E5%85%B3%E4%BA%8E_iptables_%E4%B8%8E_Dnsmasq.webp"><title>æ¢…æ—å›ºä»¶ä¸ ShellCrash çš„å†²çª - å…³äº iptables ä¸ Dnsmasq - æ°å‡ºå…½çš„å°å®‡å®™</title><link rel="stylesheet" href="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/hint.css@2.7.0/hint.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"www.jiecs.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["home"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 8.1.1"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body><style>footer{position:relative}.iframe-overlay,iframe[loading=lazy]{position:absolute;height:265px;width:300px;transform:scale(.9) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem);bottom:-100px;left:0;z-index:3;transition:transform .3s ease,clip-path .3s ease}.iframe-overlay{z-index:4;background:0 0;cursor:pointer;display:none}iframe[loading=lazy].expanded+.iframe-overlay{display:none}iframe[loading=lazy].expanded{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 0 0 0 round 1.2rem)}:root[data-user-color-scheme=light] iframe[loading=lazy]{filter:invert(1) hue-rotate(-200deg)}@media (max-width:1700px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 140px 0 round 1.2rem);transform:scale(.64)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem)}.iframe-overlay{display:block}}@media (max-width:768px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 183px 0 round 1.2rem);bottom:-38px;transform:scale(.5) scaleY(.93);left:calc(50% - 150px)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}iframe[loading=lazy].expanded{transform:scale(.8) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}}</style><script>document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector("footer"),t=document.createElement("iframe");t.frameBorder=0,t.src="https://support.nodeget.com/page/promotion?id=334%20|%20jiesou",t.loading="lazy";const n=document.createElement("div");n.className="iframe-overlay",n.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("expanded")})),e.appendChild(t),e.appendChild(n),document.addEventListener("click",(function(e){t.contains(e.target)||t.classList.remove("expanded")}))}))</script><header><div class="header-inner" style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>æ°å‡ºå…½çš„å°å®‡å®™</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>é¦–é¡µ</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/%E5%8A%A8%E6%80%81/" target="_self"><i class="iconfont icon-comment"></i> <span>åŠ¨æ€</span></a></li><li class="nav-item"><a class="nav-link" href="/projects/" target="_self"><i class="iconfont icon-code"></i> <span>é¡¹ç›®</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>å…³äº</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-link-fill"></i> <span>å‹é“¾</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="https://www.alongw.cn" target="_self"><span>é˜¿é¾™åšå®¢</span></a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" false style="background:url(https://cdn.jiecs.top/img/2024/08/cover_%E6%A2%85%E6%9E%97%E5%9B%BA%E4%BB%B6%E4%B8%8E_ShellCrash_%E7%9A%84%E5%86%B2%E7%AA%81%E5%85%B3%E4%BA%8E_iptables_%E4%B8%8E_Dnsmasq.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">æ¢…æ—å›ºä»¶ä¸ ShellCrash çš„å†²çª - å…³äº iptables ä¸ Dnsmasq</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-08-04 22:32" pubdate>2024å¹´8æœˆ4æ—¥ æ™šä¸Š</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.7k å­—</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">æ¢…æ—å›ºä»¶ä¸ ShellCrash çš„å†²çª - å…³äº iptables ä¸ Dnsmasq</h1><div class="markdown-body"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ShellCrash æŒ‰è®¾è®¡èƒ½å¤Ÿåœ¨å„ç§åŸºäº&#x2F;ç±»ä¼¼ OpenWrt çš„ç³»ç»Ÿä¸Šæ–¹ä¾¿åœ°é…ç½®ç®¡ç† mihomoã€singbox ä¹‹ç±»çš„ä»£ç†å†…æ ¸ã€‚ä½†ç”±äº Merlinï¼ˆæ¢…æ—ï¼‰å›ºä»¶çš„è®¸å¤šç»„ä»¶éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼ŒShellCrash åœ¨ Merlin ä¸Šè¿è¡Œå¯èƒ½é‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚</p><p>è¿™ç¯‡æŒ‡å—åŒ…å«å¯¹ iptablesã€ShellCrashã€Dnsmasq è¿ä½œæ–¹å¼çš„è¯´æ˜ï¼Œä½¿ç”¨äº†å¾ˆå¤šå¼ºåˆ¶è¦†å†™ä¹‹ç±»çš„ hackï¼Œå¦‚æœä½ ä¹Ÿé‡åˆ°äº†å„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œå¸Œæœ›å¯ä»¥æä¾›ä¸€äº›å‚è€ƒ</p><p>è¿™ç¯‡æŒ‡å—åº”è¯¥ä¹ŸåŒæ ·é€‚ç”¨äº OpenClash ä¹‹ç±»çš„ç¨‹åºï¼Œç”±äº Merlin å›ºä»¶å¯èƒ½å› æ›´æ–°å¯¼è‡´éƒ¨åˆ†ç‰¹æ€§å˜åŒ–ï¼Œæ‰€ä»¥æ³¨æ„æœ¬æŒ‡å—ç‰¹åˆ«é€‚ç”¨äº Merlin 3004.388.8 (388.8) ç‰ˆæœ¬ä»¥åŠ ShellCrash 1.9.0release ç‰ˆæœ¬ï¼ŒShellCrash å‡çº§åˆ° beta åéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æœ‰æ”¹å–„ï¼Œä½†ä¹Ÿæœ‰æ›´å¤šä¸å…¼å®¹ï¼ˆæˆªæ­¢ 1.9.1beta13ï¼‰ã€‚æœ¬æŒ‡å—ä¸‹ï¼Œè·¯ç”±å™¨ IP ä¸º 192.168.50.1ï¼Œå¦‚æœæ²¡æ”¹è¿‡ç½‘æ®µï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼</p><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>ShellCrash é»˜è®¤çš„ DNS é…ç½®æ˜¯å¾ˆå¤Ÿç”¨çš„ï¼Œç„¶è€Œä½ å¦‚æœå‘ç°æ— è®ºæ€ä¹ˆé…ç½®ï¼Œç”¨ <a target="_blank" rel="noopener" href="https://ipleak.net/">https://ipleak.net</a> æˆ– <a target="_blank" rel="noopener" href="https://browserleaks.com/dns">https://browserleaks.com/dns</a> ä¹‹ç±»çš„ç½‘ç«™ä»èƒ½æ‰¾åˆ°è¿è¥å•† DNS æ³„éœ²ï¼Œæˆ–è€…é—´æ­‡æ€§çš„æ³„éœ²è¯ï¼Œé‚£å¾ˆå¯èƒ½ä¸æ˜¯ä½  <strong>å†…æ ¸</strong> DNS é…ç½®çš„é—®é¢˜ï¼Œè€Œæ˜¯ ShellCrash æ²¡èƒ½æ­£ç¡®å°†æ‰€æœ‰ DNS è¯·æ±‚åŠ«æŒåˆ° <strong>å†…æ ¸</strong> ä¸­</p><div class="note note-light"><p>å†…æ ¸ DNS é…ç½®æ— è¯¯çš„æƒ…å†µä¸‹ï¼Œé™¤äº† ShellCrash å¯¹ DNS è¯·æ±‚åŠ«æŒä¸å®Œå–„å¯èƒ½å¯¼è‡´é—®é¢˜ï¼Œé—®é¢˜ä¹Ÿæœ‰å¯èƒ½æ˜¯ Windows æ™ºèƒ½å¤šå®¿ä¸»åç§°è§£æï¼ˆLink-Local Multicast Name Resolutionï¼‰å¯¼è‡´çš„ï¼Œæ­¤ç§æƒ…å†µå¯ä»¥è‡ªè¡Œæœç´¢è§£å†³ï¼Œä¸åœ¨è¿™ç¯‡æŒ‡å—çš„è®¨è®ºèŒƒå›´å†…</p></div><h3 id="ç¡®è®¤é—®é¢˜"><a href="#ç¡®è®¤é—®é¢˜" class="headerlink" title="ç¡®è®¤é—®é¢˜"></a>ç¡®è®¤é—®é¢˜</h3><p>å¦‚æœä½ æ²¡ä¿®æ”¹ç«¯å£ï¼Œé‚£ ShellCrash é»˜è®¤ä¼šè®©å†…æ ¸ DNS ç›‘å¬ <strong>1053</strong> ç«¯å£ï¼Œä¹Ÿä¼šé€šè¿‡ iptables å°† 53 ç«¯å£è½¬å‘è‡³ 1053</p><p>ä½ å¯ä»¥åœ¨è®¾å¤‡ä¸Šå°è¯•è¿è¡Œ <code>dig google.com @192.168.50.1</code> å’Œ <code>dig google.com @192.168.50.1 -p 1053</code>ã€‚å¦‚æœåè€…èƒ½å¾—åˆ°æ­£ç¡®çš„ IPï¼ˆæˆ– fakeipï¼‰ï¼Œè€Œå‰è€…åªèƒ½å¾—åˆ°å›½å†…æ±¡æŸ“åçš„ IPï¼Œé‚£å°±è¯´æ˜ ShellCrash å¯¹ DNS è¯·æ±‚çš„åŠ«æŒå­˜åœ¨é—®é¢˜ï¼Œéœ€è¦è‡ªå·±é‡æ–°å®šå‘ DNS</p><h3 id="Merlin-ä¸­çš„-DNS"><a href="#Merlin-ä¸­çš„-DNS" class="headerlink" title="Merlin ä¸­çš„ DNS"></a>Merlin ä¸­çš„ DNS</h3><p>è€Œ Merlin æœ‰è®¸å¤šå¤„åœ°æ–¹å¯ä»¥é…ç½® DNSï¼Œé…ç½®åŠå…¶å¤æ‚ï¼Œè¯´æ˜åˆä¸ç”šæ¸…æ™°ï¼Œè¿™é‡Œå°±æˆ‘çš„ç†è§£è¯´æ˜ä¸€ä¸‹</p><h4 id="LAN-DNS-Director"><a href="#LAN-DNS-Director" class="headerlink" title="LAN - DNS Director"></a>LAN - DNS Director</h4><p>è¿™æ˜¯åç¡•&#x2F;Trend Micro è‡ªå·±å®ç°çš„ä¼˜å…ˆçº§æœ€é«˜çš„ DNS é‡å®šå‘å·¥å…·ï¼Œä¸»è¦ç”¨äº <em>å®¶é•¿æ§åˆ¶</em> ç±»åŠŸèƒ½ï¼Œé€šå¸¸ä¸åº”è¯¥ç”¨ DNS Director è®¾ç½® DNS</p><div class="note note-light"><p>æ ¹æ®<a target="_blank" rel="noopener" href="https://github.com/RMerl/asuswrt-merlin.ng/wiki/DNS-Director"><em>æ–‡æ¡£</em></a>ï¼Œåœ¨è¾ƒè€çš„ Merlin å›ºä»¶ä¸­ï¼ŒDNS Director å«åš DNSFilter</p></div><h4 id="LAN-DHCP-æœåŠ¡å™¨-DNS-åŠ-WINS-æœåŠ¡å™¨è®¾ç½®"><a href="#LAN-DHCP-æœåŠ¡å™¨-DNS-åŠ-WINS-æœåŠ¡å™¨è®¾ç½®" class="headerlink" title="LAN - DHCP æœåŠ¡å™¨ - DNS åŠ WINS æœåŠ¡å™¨è®¾ç½®"></a>LAN - DHCP æœåŠ¡å™¨ - DNS åŠ WINS æœåŠ¡å™¨è®¾ç½®</h4><p>æ­¤å¤„é…ç½®çš„ DNS åªæ˜¯åœ¨åˆ†é… IP çš„æ—¶å€™æŒ‡å®šï¼Œé»˜è®¤å°±æ˜¯ 192.168.50.1ï¼Œäº¤ç”±è·¯ç”±å™¨å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿå¯é…ç½®â€œAdvertise routerâ€™s IP in addition to user-specified DNSâ€ï¼Œå³ åœ¨ç”¨æˆ·æŒ‡å®šçš„ DNS ä¹‹å¤–ï¼Œè¿˜é™„ä¸Šè·¯ç”±å™¨çš„ IPã€‚é€šå¸¸å…¨éƒ¨äº¤ç»™è·¯ç”±å™¨å¤„ç†å³å¯</p><h4 id="WAN-äº’è”ç½‘-DNS-è®¾ç½®"><a href="#WAN-äº’è”ç½‘-DNS-è®¾ç½®" class="headerlink" title="WAN - äº’è”ç½‘ DNS è®¾ç½®"></a>WAN - äº’è”ç½‘ DNS è®¾ç½®</h4><p>æ­¤å¤„é…ç½®çš„ DNS æ˜¯ <strong>è·¯ç”±å™¨æœ¬èº« Dnsmasq</strong> çš„ DNS é…ç½®ï¼Œå³å…³äº 192.168.50.1:53 çš„é…ç½®ï¼Œé»˜è®¤è‡ªåŠ¨ä½¿ç”¨è¿è¥å•† DNSã€‚ä¼šå½±å“è·¯ç”±å™¨è‡ªå·±çš„ç½‘ç»œï¼Œå¦‚æœè®¾å¤‡å°† DNS è¯·æ±‚äº¤ç»™è·¯ç”±å™¨ï¼ˆå¦‚ DHCP åˆ†é…è·¯ç”±å™¨ IP ä½œä¸º DNS æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼‰ï¼Œä¹Ÿä¼šå½±å“è¿æ¥åˆ°è¯¥è·¯ç”±å™¨çš„è®¾å¤‡</p><p>Merlin å†…ç½® Dnsmasq ç”¨äºå¤„ç† DNSï¼ŒDnsmasq çš„é…ç½®ä½äº <code>/etc/dnsmasq.conf</code>ï¼Œå…¶ä¸­å¼•ç”¨äº† <code>servers-file=/tmp/resolv.dnsmasq</code> ï¼Œè€Œ WAN å¤„çš„ DNS é…ç½®å°±æ­£å¯¹åº”äº† <code>/tmp/resolv.conf</code> çš„å†…å®¹</p><div class="note note-light"><p>æ ¹æ®<a target="_blank" rel="noopener" href="https://github.com/RMerl/asuswrt-merlin.ng/wiki/Custom-domains-with-dnsmasq"><em>æ–‡æ¡£</em></a>ï¼Œä½ å¯ä»¥é€šè¿‡ <code>/jffs/configs/dnsmasq.conf.add</code> åœ¨ Dnsmasq é…ç½®æœ«å°¾æ·»åŠ æ–°é…ç½®ã€‚ä½†è¿™ç§æ–¹å¼ä¸é€‚ç”¨äºè§£å†³ DNS æ³„éœ²é—®é¢˜ï¼Œå› ä¸º Dnsmasq ä¼šå¹¶å‘æ‰€æœ‰ DNS æœåŠ¡å™¨ï¼Œå³ä½¿é…ç½®ä¸º <code>strict-order</code> ä¹Ÿä¼šå› æ‰€æ·»åŠ çš„é…ç½®åœ¨é…ç½®æœ«å°¾ï¼Œå¯¼è‡´é¡ºåºä¸Šä¸ä¼˜å…ˆä½¿ç”¨è®¾å®šçš„ DNS æœåŠ¡å™¨</p></div><h3 id="å¼€å§‹æ“ä½œ"><a href="#å¼€å§‹æ“ä½œ" class="headerlink" title="å¼€å§‹æ“ä½œ"></a>å¼€å§‹æ“ä½œ</h3><p>ç®¡ç†é¢æ¿ä¸­ä»¥ä¸Šä¸‰å¤„éƒ½èƒ½æ”¹ DNSï¼Œç„¶è€Œéƒ½è¢«é™åˆ¶ä¸èƒ½è‡ªå®šä¹‰ DNS æœåŠ¡å™¨çš„ç«¯å£ã€‚å†…æ ¸ç›‘å¬çš„æ˜¯ 1053 ç«¯å£ï¼Œè‚¯å®šéœ€è¦è‡ªå®šä¹‰ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±è¦†å†™ Dnsmasq é…ç½®ï¼š</p><ol><li>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä¸ºé˜²æ­¢ä¸æˆ‘ä»¬è‡ªå·±çš„ DNS å¤„ç†å†²çªï¼Œä½ è¦åœ¨ crash èœå•çš„ 7-6-7 å¤„ï¼ˆæ–°ç‰ˆå¯èƒ½å˜åŒ–ï¼‰ç¦ç”¨ ShellCrash è‡ªå·±çš„ DNS åŠ«æŒ</li><li>æˆ‘ä»¬è¦ä¿®æ”¹çš„æ˜¯ <code>/tmp/resolv.dnsmasq</code> çš„é…ç½®ï¼Œå¯ä»¥å…ˆç¡®è®¤ä¸€ä¸‹è¿™ä¸ªé…ç½®çš„å†…å®¹ï¼Œç”¨ <code>cp /tmp/resolv.dnsmasq /tmp/resolv.dnsmasq.bak</code> å¤‡ä»½åŸå§‹é…ç½®</li><li>ç„¶åè¿è¡Œ <code>echo &quot;server=192.168.50.1#1053&quot; &gt; /tmp/resolv.dnsmasq</code> è¦†å†™åŸé…ç½®ã€‚ç”¨ # è¡¨ç¤ºç«¯å£</li><li>ç”¨ <code>service restart_dnsmasq</code> é‡å¯ Dnsmasq æœåŠ¡</li></ol><h4 id="User-script-é˜²è¦†ç›–"><a href="#User-script-é˜²è¦†ç›–" class="headerlink" title="User script é˜²è¦†ç›–"></a>User script é˜²è¦†ç›–</h4><p>ä¸ºé˜²æ­¢é…ç½®é‡æ–°è¢« Merlin æ”¹å†™å›å»ï¼Œä½ å¯ä»¥é€šè¿‡ Merlin çš„ <a target="_blank" rel="noopener" href="https://github.com/RMerl/asuswrt-merlin.ng/wiki/User-scripts">User script</a> åŠŸèƒ½åœ¨è·¯ç”±å™¨å¯åŠ¨åè‡ªåŠ¨è¦†å†™é…ç½®</p><p>æ¯”å¦‚ï¼Œä½ å¯ä»¥åˆ›å»º <code>/jffs/scripts/override-dnsmasq.sh</code> å¹¶ç²˜è´´ä¸Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰§è¡Œ Dnsmasq å¤å†™</span><br>cp /tmp/resolv.dnsmasq /tmp/resolv.dnsmasq.bak # å¤‡ä»½åŸå§‹<br>echo &quot;server=192.168.50.1#1053&quot; &gt; /tmp/resolv.dnsmasq<br>service restart_dnsmasq<br></code></pre></td></tr></table></figure><div class="note note-light"><p>å¯ä»¥è‡ªå·±è¯•è¿è¡Œä¸€ä¸‹ã€‚æ³¨æ„è¿˜è¦ <code>chmod +x /jffs/scripts/override-dnsmasq.sh</code> ä¸º .sh æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™</p></div><p>ç„¶ååœ¨ <code>/jffs/scripts/nat-start</code> æˆ–å…¶ä»– User script Hook ç‚¹ï¼ˆå¤§å¤šæ•°éƒ½å¯ä»¥ï¼‰ä¸­æ·»åŠ  <code>sh /jffs/scripts/override-dnsmasq.sh</code> æ¥è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªè„šæœ¬</p><div class="note note-light"><p>ShellCrash é»˜è®¤ä¹Ÿæ˜¯åœ¨ nat-start å¤„åˆå§‹åŒ– ShellCrash çš„ï¼Œæ·»åŠ å nat-start çœ‹èµ·æ¥åº”è¯¥åƒè¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/jffs/ShellCrash/start.sh init #ShellCrashåˆå§‹åŒ–è„šæœ¬<br><br>sh /jffs/scripts/start-services.sh<br></code></pre></td></tr></table></figure></div><h3 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h3><p>DNS é…ç½®å®Œæˆäº†ğŸ‰</p><p>å›åˆ° <a href="#%E7%A1%AE%E8%AE%A4%E9%97%AE%E9%A2%98">ç¡®è®¤é—®é¢˜</a> å¹¶ç”¨ <a target="_blank" rel="noopener" href="https://ipleak.net/">https://ipleak.net</a> æˆ– <a target="_blank" rel="noopener" href="https://browserleaks.com/dns">https://browserleaks.com/dns</a> ä¹‹ç±»çš„ç½‘ç«™æ¥æ£€æŸ¥ä¸€ä¸‹è¿˜æœ‰æ²¡æœ‰é—®é¢˜å§ï¼</p><div class="note note-light"><p>å¦‚æœä½ æœ‰å¯¹å›½å†…ç½‘ç«™è®¾ç½®å›½å†…çš„ DNSï¼Œé‚£è¿˜å¯ä»¥ç”¨ç½‘æ˜“çš„ <a target="_blank" rel="noopener" href="https://nstool.netease.com/">https://nstool.netease.com</a> è¿™ä¸ªç½‘ç«™æ¥æ£€æŸ¥ä½ åœ¨å›½å†…ä½¿ç”¨çš„ DNS æœåŠ¡å™¨</p></div><h3 id="æœ¬æœºä»£ç†é—®é¢˜"><a href="#æœ¬æœºä»£ç†é—®é¢˜" class="headerlink" title="æœ¬æœºä»£ç†é—®é¢˜"></a>æœ¬æœºä»£ç†é—®é¢˜</h3><p>å®é™…ä¸Šï¼Œå®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œè®¾å¤‡åº”å½“å°±å·²ç»èƒ½å¤Ÿæ­£å¸¸ä¸Šç½‘äº†ã€‚ç„¶è€Œï¼Œç”±äºå¯¹ Dnsmasq çš„é…ç½®ï¼Œè·¯ç”±å™¨æœ¬èº«ï¼ˆæœ¬æœºï¼‰è¿›è¡Œ DNS è§£ææ—¶ä¹Ÿä¼šé€šè¿‡å†…æ ¸çš„ <code>192.168.50.1#1053</code> DNS è¿›è¡Œï¼Œè€Œå¦‚æœä½ åœ¨ä½¿ç”¨ fakeip æ¨¡å¼ï¼Œå¹¶æ²¡æœ‰é…ç½®æœ¬æœºä»£ç†çš„è¯ï¼Œé‚£ä¾¿ä¼šå¯¼è‡´ <strong>è·¯ç”±å™¨è‡ªå·±</strong> æ— æ³•æ­£å¸¸ä¸Šç½‘ï¼Œå› ä¸ºè·¯ç”±å™¨è§£æå‡ºçš„æ˜¯ fakeipï¼Œè€Œå‡ºç«™æµé‡å´ä¸ç»è¿‡å†…æ ¸ï¼Œé‚£ fake çš„ ip è‚¯å®šå°±è¿ä¸ä¸Šäº†</p><p>è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼š</p><ol><li>å¦‚æœä½ å¸Œæœ›æœ¬æœºä¹Ÿèƒ½ä»£ç†ï¼Œé‚£éœ€è¦è®©æœ¬æœºæµé‡ä¹Ÿèµ°å†…æ ¸ã€‚ä½† ShellCrash ç›®å‰ç‰ˆæœ¬ï¼ˆ1.9.0releaseï¼‰å¯¹æœ¬æœºä»£ç†çš„æ”¯æŒå¹¶ä¸å¾ˆå¥½ï¼Œåªæ”¯æŒä»¥â€œç¯å¢ƒå˜é‡â€çš„æ–¹å¼ä»£ç†ã€‚ä½ å½“ç„¶å¯ä»¥å°è¯•è‡ªå·±ç”¨ iptables åœ¨ OUTPUT é“¾ä¸Šè®¾ç½®è§„åˆ™ï¼Œåªæ˜¯ä¼šæ¯”è¾ƒæŠ˜è…¾</li><li>å¦‚æœä½ è®¤ä¸ºæœ¬æœºæ²¡å¿…è¦ä»£ç†ï¼Œé‚£å¯ä»¥åªåŠ«æŒæœ¬æœºè‡ªå·±çš„ DNS è¯·æ±‚ï¼Œé‡å®šå‘åˆ°ä¸€ä¸ªèƒ½æ­£å¸¸è§£æå‡º <strong>çœŸ IP</strong> çš„ DNS æœåŠ¡å™¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰§è¡Œè¿™æ¡å‘½ä»¤æ¥é€šè¿‡ iptables è®¾ç½®åŠ«æŒï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">iptables -t nat -A OUTPUT -p udp --dport 53 -d 192.168.50.1 -j DNAT --to-destination 8.8.8.8<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ nat è¡¨çš„ OUTPUT é“¾ä¸­è¦æ±‚ NAT å°†å‘ <code>192.168.50.1:53</code> è¯·æ±‚çš„ç›®æ ‡åœ°å€è½¬æ¢ä¸º <code>8.8.8.8(:53)</code></p><p>ç”±äºè¿™ä¸ªè§„åˆ™åœ¨ OUTPUT é“¾ä¸Šï¼Œæ‰€ä»¥å®ƒä¸ä¼šå½±å“åˆ°è¿æ¥è·¯ç”±å™¨çš„å…¶ä»–è®¾å¤‡ï¼Œè€Œåªå½±å“è·¯ç”±å™¨æœ¬æœºï¼Œè¯¦ç»†åŸç†å¯å‚è€ƒä»¥ä¸‹ <a href="#iptables-%E8%BF%90%E4%BD%9C%E6%96%B9%E5%BC%8F">iptables è¿ä½œæ–¹å¼</a></p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åƒ<a href="#user-script-%E9%98%B2%E8%A6%86%E7%9B%96">ä¸Šé¢</a>ä¸€æ ·æŠŠè¿™ä¸ªå‘½ä»¤æ·»åŠ åˆ° User script çš„ <code>firewall-start</code> Hook ç‚¹ä¸Šï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªè„šæœ¬é¿å…è§„åˆ™è¢«é‡å¤æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å®šå‘è·¯ç”±å™¨ DNS</span><br>DNS_RULE=&quot;OUTPUT -p udp --dport 53 -d 192.168.50.1 -j DNAT --to-destination 8.8.8.8&quot;<br><br>if ! iptables -t nat -C $DNS_RULE 2&gt;/dev/null; then<br>    iptables -t nat -A $DNS_RULE<br>fi<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>-C</code> flag å³ç”¨äºç¡®è®¤è¯¥è§„åˆ™æ˜¯å¦å­˜åœ¨ï¼Œ <code>2&gt;/dev/null</code> ç”¨äºå¤„ç†é”™è¯¯è¾“å‡ºï¼ˆè§„åˆ™ä¸å­˜åœ¨å³æŠ¥é”™ï¼‰</p><h2 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h2><p>é™¤äº† DNS é—®é¢˜ï¼ŒMerlin è‡ªå¸¦çš„é˜²ç«å¢™é…ç½®ï¼Œå°¤å…¶æ˜¯ é˜²ç«å¢™ - <strong>IPv6 é˜²ç«å¢™</strong> ä¹Ÿä¼šä¸ ShellCrash å¯¹ IPv6 çš„æµé‡åŠ«æŒäº§ç”Ÿå†²çª</p><h3 id="ç¡®è®¤é—®é¢˜-1"><a href="#ç¡®è®¤é—®é¢˜-1" class="headerlink" title="ç¡®è®¤é—®é¢˜"></a>ç¡®è®¤é—®é¢˜</h3><p>å®é™…ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å–æ¶ˆå‹¾é€‰ <code>å¯åŠ¨ IPv6 é˜²ç«å¢™</code>ã€‚å¦‚æœå…³é—­ IPv6 é˜²ç«å¢™ åç½‘ç»œä¸å­˜åœ¨é—®é¢˜ï¼Œé‚£ä¾¿å¯ä»¥ç¡®å®šé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œ</p><p>å½“ç„¶å…³é—­æ•´ä¸ª IPv6 é˜²ç«å¢™è‚¯å®šæ˜¯å­˜åœ¨å®‰å…¨é£é™©çš„ï¼ŒMerlin å†…å»ºçš„é˜²ç«å¢™å…¶å®åŸºäºä¸€æ¡æ¡ iptables è§„åˆ™ï¼ŒIPv6 é˜²ç«å¢™åˆ™åŸºäº <strong>ip6tables</strong> ï¼Œæœ€å¥½æ˜¯ææ¸…æ¥šé˜²ç«å¢™çš„è¿ä½œåŸç†ï¼Œå¹¶è‡ªå·±æ­£ç¡®é…ç½®å®ƒä»¬</p><h3 id="iptables-è¿ä½œæ–¹å¼"><a href="#iptables-è¿ä½œæ–¹å¼" class="headerlink" title="iptables è¿ä½œæ–¹å¼"></a>iptables è¿ä½œæ–¹å¼</h3><p>iptables å†…å»ºäº Merlin å›ºä»¶ä¸­ï¼Œç”¨äºæ§åˆ¶æ•°æ®åŒ…çš„å¤„ç†å’Œè½¬å‘ï¼Œä½ å¯ä»¥åœ¨å®ƒå„ä¸ª <strong>è¡¨</strong> çš„å„ä¸ª <strong>é“¾</strong> ä¸Šè®¾ç½®è§„åˆ™</p><pre>
<code class="mermaid">
flowchart BT
    subgraph ç½‘ç»œå±‚è¾“å…¥
        in(["è¾“å…¥"]) --> PREROUTING
        PREROUTING --> routing(["è·¯ç”±å†³ç­–"])
    end

    subgraph æœ¬æœº
        routing(["è·¯ç”±å†³ç­–"]) --> INPUT
        INPUT --> local(("æœ¬æœºï¼ˆShellCrashï¼‰"))
        local(("æœ¬æœºï¼ˆShellCrashï¼‰")) --> OUTPUT
    end

    subgraph è½¬å‘å¤„ç†
        routing(["è·¯ç”±å†³ç­–"]) --> FORWARD
    end

    subgraph ç½‘ç»œå±‚è¾“å‡º
        FORWARD --> POSTROUTING
        OUTPUT --> POSTROUTING
        POSTROUTING --> out(["è¾“å‡º"])
    end

    style æœ¬æœº fill:#f9f,stroke:#333,stroke-width:2px
    style è½¬å‘å¤„ç† fill:#bbf,stroke:#333,stroke-width:2px
    style ç½‘ç»œå±‚è¾“å…¥ fill:#ff9,stroke:#333,stroke-width:2px
    style ç½‘ç»œå±‚è¾“å‡º fill:#ff9,stroke:#333,stroke-width:2px
</code>
</pre><p>è¿™ä¸ªæµç¨‹å›¾ä¸­çš„ æ–¹æ¡† å¦‚ <code>PREROUTING</code> ã€ <code>FORWARD</code> å³å±äºä¸åŒ <strong>è¡¨</strong> ä¸­çš„ <strong>é“¾</strong></p><p>ä¸»è¦æœ‰å››å¼ è¡¨ï¼š</p><ul><li>filter</li><li>mangle</li><li>nat</li><li>raw</li></ul><p>äº”æ¡é“¾ï¼š</p><ul><li>PREROUTING</li><li>FORWARD</li><li>INPUT</li><li>OUTPUT</li><li>POSTROUTING</li></ul><p>å³å¸¸è¯´çš„â€œå››è¡¨äº”é“¾â€</p><p>å½“ç„¶ä¹Ÿå¯èƒ½æœ‰å…¶ä»–å„ç§è¡¨å’Œé“¾ï¼Œæ¯”å¦‚ <code>security</code> è¡¨ï¼Œè¿˜æœ‰ ShellCrash ä¼šåœ¨ mangle è¡¨åˆ›å»ºçš„ <code>shellcrashv6</code> é“¾ï¼Œä½†æˆ‘ä»¬é€šå¸¸ä¸ç”¨åŠ¨é‚£äº›è¡¨å’Œé“¾</p><h4 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h4><p>æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ <code>ip6tables -t filter -nvL INPUT</code> æŸ¥çœ‹ filter è¡¨ä¸­ INPUT é“¾ä¸Šçš„è§„åˆ™ï¼Œè§„åˆ™ä»ä¸Šå¾€ä¸‹æŒ‰é¡ºåºåŒ¹é…</p><p>å…¶ä¸­ï¼š</p><ul><li>t [map] ç”¨äºæŒ‡å®šè¦æŸ¥å“ªå¼ è¡¨ï¼Œå®é™…ä¸Šä¸å¡«é»˜è®¤å°±æ˜¯ <code>filter</code> è¡¨</li><li>n è¡¨ç¤ºä¸å¯¹ ip è¿›è¡ŒåŸŸåè§£æï¼Œè®©è¿”å›å¿«å¾ˆå¤š</li><li>v è¡¨ç¤ºæ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚ <code>pkts</code> å’Œ <code>bytes</code> åˆ—</li><li>L è¡¨ç¤ºåˆ—å‡ºè§„åˆ™</li></ul><p>ä½ è¿˜å¯ä»¥ç”¨ <code>ip6tables-save</code> æŸ¥çœ‹ç°æœ‰çš„æ‰€æœ‰è¡¨ï¼Œå¹¶å¾—åˆ° <strong>å¯ä»¥ä½œä¸ºå‘½ä»¤æ¥æ·»åŠ æ‰§è¡Œ</strong> çš„æ ¼å¼</p><p>ShellCrash ä¹Ÿæ˜¯é  iptables <strong>åŠ«æŒæµé‡</strong> çš„ã€‚ä»¥ tproxy æ¨¡å¼ä¸¾ä¾‹ï¼ŒShellCrash ä¼šåœ¨ PREROUTING ä¸­é€šè¿‡ tproxyï¼ˆé€æ˜ä»£ç†ï¼‰å’Œè·¯ç”±è¡¨å°†æœ¬è¯¥é€šè¿‡ FORWARD åˆ°å…¬ç½‘çš„æµé‡ï¼Œ <strong>é‡å®šå‘åˆ°æœ¬æœºçš„ INPUT</strong> ï¼Œå¹¶åœ¨ mihomo&#x2F;sing-box å†…æ ¸ä¸­å¤„ç†æµé‡</p><p>ç”±äº PREROUTING é“¾ä½äº mangle è¡¨ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡<code>ip6tables -t mangle -nvL</code> æŸ¥çœ‹æ•´ä¸ª mangle è¡¨çš„å†…å®¹ï¼Œå…¶ä¸­åŒ…æ‹¬äº† ShellCrash åœ¨ PREROUTING é“¾è®¾ç½®çš„è§„åˆ™ï¼Œä¹ŸåŒ…æ‹¬äº†å®ƒè‡ªå·±åˆ›å»ºçš„ <code>shellcrashv6</code> é“¾ã€‚è¾“å‡ºåº”è¯¥å½¢ä¼¼è¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell">Chain PREROUTING (policy ACCEPT 1843K packets, 2274M bytes)<br> pkts bytes target     prot opt in     out     source               destination         <br>2176K 2300M shellcrashv6  tcp      *      *       ::/0                 ::/0                <br> 107K   54M shellcrashv6  udp      *      *       ::/0                 ::/0                <br><br>Chain INPUT (policy ACCEPT 2294K packets, 2355M bytes)<br> pkts bytes target     prot opt in     out     source               destination         <br><br>Chain FORWARD (policy ACCEPT 40213 packets, 3977K bytes)<br> pkts bytes target     prot opt in     out     source               destination         <br><br>Chain OUTPUT (policy ACCEPT 1694K packets, 2232M bytes)<br> pkts bytes target     prot opt in     out     source               destination         <br><br>Chain POSTROUTING (policy ACCEPT 1739K packets, 2236M bytes)<br> pkts bytes target     prot opt in     out     source               destination         <br><br>Chain shellcrashv6 (2 references)<br> pkts bytes target     prot opt in     out     source               destination         <br>22957 1991K RETURN     udp      *      *       ::/0                 ::/0                 udp dpt:53<br> 6309  460K RETURN     all      *      *       ::/0                 240x:xxxx:xxxx:xxxx::/64 <br>1748K 2264M RETURN     all      *      *       ::/0                 240x:xxxx:xxxx:xxxx::/64 <br>    0     0 RETURN     all      *      *       ::/0                 ::/128              <br>    0     0 RETURN     all      *      *       ::/0                 ::1/128             <br>    0     0 RETURN     all      *      *       ::/0                 ::ffff:0.0.0.0/96   <br>   13  1040 RETURN     all      *      *       ::/0                 64:ff9b::/96        <br>    0     0 RETURN     all      *      *       ::/0                 100::/64            <br> 1360 97998 RETURN     all      *      *       ::/0                 2001::/32           <br>    0     0 RETURN     all      *      *       ::/0                 2001:20::/28        <br>    0     0 RETURN     all      *      *       ::/0                 2001:db8::/32       <br>   41  4670 RETURN     all      *      *       ::/0                 2002::/16           <br> 4400  348K RETURN     all      *      *       ::/0                 fc00::/7            <br>   25  4350 RETURN     all      *      *       ::/0                 fe80::/10           <br> 5737 1554K RETURN     all      *      *       ::/0                 ff00::/8            <br> 463K   79M TPROXY     tcp      *      *       240x:xxxx:xxxx:xxxx::/64  ::/0                 TPROXY redirect :::7893 mark 0x1ed4/0xffffffff<br>    0     0 TPROXY     tcp      *      *       240x:xxxx:xxxx:xxxx::/64  ::/0                 TPROXY redirect :::7893 mark 0x1ed4/0xffffffff<br>32340 6248K TPROXY     udp      *      *       240x:xxxx:xxxx:xxxx::/64  ::/0                 TPROXY redirect :::7893 mark 0x1ed4/0xffffffff<br>    0     0 TPROXY     udp      *      *       240x:xxxx:xxxx:xxxx::/64  ::/0                 TPROXY redirect :::7893 mark 0x1ed4/0xffffffff<br></code></pre></td></tr></table></figure><p>è¡¨çš„å†…å®¹éƒ½å¾ˆå¥½ç†è§£ã€‚å…¶ä¸­ï¼š</p><ul><li><code>pkts</code> æŒ‡é€šè¿‡è¿™æ¡è§„åˆ™çš„åŒ…æ•°</li><li><code>bytes</code> æŒ‡é€šè¿‡è¿™æ¡è§„åˆ™çš„å­—èŠ‚æ•°</li></ul><p>å¯ä»¥ç”¨æ¥ç¡®å®šè§„åˆ™æœ‰æ²¡æœ‰åœ¨æ­£å¸¸å·¥ä½œ</p><h3 id="Merlin-ä¸­çš„é˜²ç«å¢™"><a href="#Merlin-ä¸­çš„é˜²ç«å¢™" class="headerlink" title="Merlin ä¸­çš„é˜²ç«å¢™"></a>Merlin ä¸­çš„é˜²ç«å¢™</h3><p><img src="https://cdn.jiecs.top/img/2024/08/1000013046.webp" srcset="/img/loading.gif" lazyload alt="FORWARD diff"></p><p><img src="https://cdn.jiecs.top/img/2024/08/1000013045.webp" srcset="/img/loading.gif" lazyload alt="INPUT diff"></p><p>é€šè¿‡å¯¹æ¯”å…³é—­å’Œå¼€å¯ IPv6 é˜²ç«å¢™çš„ ip6tables è§„åˆ™ï¼Œå¯ä»¥æ³¨æ„åˆ°ï¼š</p><ul><li>åœ¨ FORWARD é“¾ï¼Œå¤šäº†æ ¹æ®é¢æ¿è®¾ç½®çš„ç«¯å£ç™½åå•ï¼ˆACCEPTï¼‰ã€‚åŒæ—¶é¡¶éƒ¨çš„ policyï¼ˆå³é»˜è®¤ç­–ç•¥ï¼‰ï¼Œä» ACCEPT å˜æˆäº† DROPï¼ˆå³ä¸¢å¼ƒï¼‰</li><li>åœ¨ INPUT é“¾ï¼Œæœ€ä¸‹é¢å¤šäº†ä¸€æ¡å…¨éƒ¨ DROP çš„è§„åˆ™</li></ul><p>ç›¸å½“äº</p><pre>
<code class="mermaid">
flowchart BT
    subgraph ç½‘ç»œå±‚è¾“å…¥
        in(["è¾“å…¥"]) --> PREROUTING
        PREROUTING --> routing(["è·¯ç”±å†³ç­–"])
    end

    subgraph æœ¬æœº
        routing(["è·¯ç”±å†³ç­–"])  --x |"DROP"| INPUT
        INPUT --> local(("æœ¬æœº"))
        local(("æœ¬æœºï¼ˆShellCrashï¼‰")) --> OUTPUT
    end

    subgraph è½¬å‘å¤„ç†
        routing(["è·¯ç”±å†³ç­–"])  --x |"éç™½åå•å°± DROP"| FORWARD
    end

    subgraph ç½‘ç»œå±‚è¾“å‡º
        FORWARD --> POSTROUTING
        OUTPUT --> POSTROUTING
        POSTROUTING --> out(["è¾“å‡º"])
    end

    style æœ¬æœº fill:#f9f,stroke:#333,stroke-width:2px
    style è½¬å‘å¤„ç† fill:#bbf,stroke:#333,stroke-width:2px
    style ç½‘ç»œå±‚è¾“å…¥ fill:#ff9,stroke:#333,stroke-width:2px
    style ç½‘ç»œå±‚è¾“å‡º fill:#ff9,stroke:#333,stroke-width:2px
    linkStyle 5 stroke:red
    linkStyle 2 stroke:red
</code>
</pre><p>FORWARD é“¾å¯¹ ShellCrash åº”å½“æ²¡æœ‰å½±å“</p><p>ä½†å‚ç…§<a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C">æ­¤å¤„</a>å¯¹ ShellCrash åŸç†çš„è¯´æ˜ï¼ŒShellCrash åŠ«æŒçš„æµé‡è‚¯å®šè¦ <strong>ç»è¿‡ INPUT</strong> ï¼Œåˆ°æœ¬æœºçš„å†…æ ¸é‡Œå»å¤„ç†ã€‚è€Œæœ¬æœºçš„ INPUT å…¥ç«™å§‹ç»ˆè¢« DROPï¼Œè‡ªç„¶ä¾¿æ— æ³•æ­£å¸¸ä½¿ç”¨ IPv6 äº†</p><h3 id="å¼€å§‹æ“ä½œ-1"><a href="#å¼€å§‹æ“ä½œ-1" class="headerlink" title="å¼€å§‹æ“ä½œ"></a>å¼€å§‹æ“ä½œ</h3><p>è¦è§£å†³è¿™ä¸€é—®é¢˜ï¼Œè‡ªç„¶å°±æ˜¯è¦è®© ShellCrash åŠ«æŒçš„æµé‡ä¸è¢« DROP æ‰ã€‚ä»é—®é¢˜å‡ºå‘ï¼Œä¸»è¦æœ‰ä¸¤ç§åŠæ³•</p><h4 id="æ–¹æ³•ä¸€ï¼šåœ¨-DROP-è§„åˆ™çš„ä¸Šé¢æ’å…¥-ACCEPT-è§„åˆ™"><a href="#æ–¹æ³•ä¸€ï¼šåœ¨-DROP-è§„åˆ™çš„ä¸Šé¢æ’å…¥-ACCEPT-è§„åˆ™" class="headerlink" title="æ–¹æ³•ä¸€ï¼šåœ¨ DROP è§„åˆ™çš„ä¸Šé¢æ’å…¥ ACCEPT è§„åˆ™"></a>æ–¹æ³•ä¸€ï¼šåœ¨ DROP è§„åˆ™çš„ä¸Šé¢æ’å…¥ ACCEPT è§„åˆ™</h4><p>ç”¨ <code>ip6tables -I INPUT 1 -i ppp0 -j ACCEPT</code> åœ¨ INPUT é“¾çš„é¦–ä½æ’å…¥â€å¯¹æ‰€æœ‰æ¥è‡ª ppp0 ç½‘ç»œæ¥å£ï¼ˆIPv6ï¼‰çš„æµé‡éƒ½ ACCEPTâ€è§„åˆ™</p><p>å…¶ä¸­</p><ul><li><code>-I [Chain] 1</code> å³è¡¨ç¤ºåœ¨æŒ‡å®šé“¾çš„ç¬¬ 1 ä½æ’å…¥è§„åˆ™</li></ul><h4 id="æ–¹æ³•äºŒï¼šåˆ å»åŸæœ¬çš„-DROP-è§„åˆ™"><a href="#æ–¹æ³•äºŒï¼šåˆ å»åŸæœ¬çš„-DROP-è§„åˆ™" class="headerlink" title="æ–¹æ³•äºŒï¼šåˆ å»åŸæœ¬çš„ DROP è§„åˆ™"></a>æ–¹æ³•äºŒï¼šåˆ å»åŸæœ¬çš„ DROP è§„åˆ™</h4><p>ç”¨ <code>ip6tables -D INPUT -j DROP</code> ç›´æ¥åˆ æ‰é‚£æ¡ DROP è§„åˆ™</p><p>å…¶ä¸­</p><ul><li><code>-D [Chain]</code> å³è¡¨ç¤ºåœ¨æŒ‡å®šé“¾ä¸­åˆ é™¤è§„åˆ™</li></ul><p>ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ï¼Œä¹ŸåŒæ ·éœ€è¦æŠŠè¿™ä¸ªå‘½ä»¤æ·»åŠ åˆ° User script çš„ <code>firewall-start</code> Hook ç‚¹ä¸Šï¼Œå‚ç…§<a href="#user-script-%E9%98%B2%E8%A6%86%E7%9B%96">ä¸Šæ–‡</a></p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>å¦‚æœä½ åœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå¯ä»¥ç”¨è¿™äº›å°å·¥å…·å°æŠ€å·§æ–¹ä¾¿è°ƒè¯•ã€é€ææµé‡</p><h3 id="Entware"><a href="#Entware" class="headerlink" title="Entware"></a>Entware</h3><p><a target="_blank" rel="noopener" href="https://github.com/Entware/Entware">Entware</a> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é€‚ç”¨äºåµŒå…¥å¼çš„åŒ…ç®¡ç†å™¨ï¼Œå³ä½¿è·¯ç”±å™¨å›ºä»¶ä¸æ˜¯ OpenWrtï¼Œä¹Ÿå¯ä½¿ç”¨ <code>opkg</code> ä¹‹ç±»çš„å‘½ä»¤</p><p>Merlin å›ºä»¶å†…å»ºäº† <em>amtm - the Asuswrt-Merlin Terminal Menu</em> ï¼Œæ–¹ä¾¿ä½ åœ¨ Merlin ä¸Šå®‰è£… Entware ä¹‹ç±»çš„ç¨‹åº</p><ol><li>è¿è¡Œ <code>amtm</code>æ‰“å¼€ amtmï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€å¯èƒ½è¦æ±‚é…ç½®ä¸»é¢˜ï¼Œå¯ä»¥ç›´æ¥é€‰ç¬¬ä¸€ä¸ª</li><li>åœ¨ amtm ä¸­ï¼Œè¾“å…¥ <code>i</code> å¯æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ç¨‹åºï¼Œå‚ç…§æŒ‡ç¤ºè¾“å…¥ <code>ep</code> å³å¯åœ¨ä¸€ä¸ª U ç›˜ä¸Šå®‰è£… entware</li></ol><p>äº‹å®ä¸Š Merlin å†…å»ºçš„ SSH æœåŠ¡ç«¯æ˜¯ä¸æ”¯æŒ SFTP çš„ï¼Œè€Œæœ‰äº† Entwareï¼Œä½ ä¾¿å¯ä»¥ç›´æ¥è¾“å…¥ <code>opkg install openssh-sftp-server</code> æ¥å®‰è£… sftpã€‚ä¸éœ€è¦ä»»ä½•é…ç½®ï¼Œä¹Ÿä¸ç”¨æŠ˜è…¾ FTP ä¹‹ç±»çš„ï¼Œéšä¾¿æ‰¾ä¸€ä¸ª SFTP çš„å®¢æˆ·ç«¯å³å¯è½»æ¾ç®¡ç†è·¯ç”±å™¨ä¸­çš„æ–‡ä»¶ç³»ç»Ÿ</p><h3 id="ç”¨-Wireshark-åœ¨è·¯ç”±å™¨ä¸ŠæŠ“åŒ…"><a href="#ç”¨-Wireshark-åœ¨è·¯ç”±å™¨ä¸ŠæŠ“åŒ…" class="headerlink" title="ç”¨ Wireshark åœ¨è·¯ç”±å™¨ä¸ŠæŠ“åŒ…"></a>ç”¨ Wireshark åœ¨è·¯ç”±å™¨ä¸ŠæŠ“åŒ…</h3><p>Wireshark ä½œä¸ºå¾ˆå¼ºå¤§çš„æŠ“åŒ…å·¥å…·ï¼Œæ”¯æŒé€šè¿‡ SSH è¿æ¥è¿œç¨‹è®¾å¤‡å¹¶é€šè¿‡ tcpdump&#x2F;dumpcap æŠ“å–æµé‡ã€‚è‡ªç„¶ä¹Ÿå¯ä»¥è¿æ¥åˆ°è·¯ç”±å™¨çš„ SSH ä¸ŠæŠ“åŒ…</p><ol><li>Merlin å›ºä»¶å¹¶ä¸å†…å»º tcpdumpï¼Œå‚ç…§<a href="#entware">ä»¥ä¸Š</a>è¯´æ˜å®‰è£… Entware ä¹‹åï¼Œä½ ä¾¿ä¹Ÿå¯ä»¥é€šè¿‡ <code>opkg</code> å®‰è£…æ¥å®‰è£… tcpdump</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">opkg install tcpdump<br></code></pre></td></tr></table></figure><ol start="2"><li>æ‰“å¼€ Wireshark å®¢æˆ·ç«¯ï¼Œæ‰“å¼€ <code>æ•è· - é€‰é¡¹</code></li></ol><p><img src="https://cdn.jiecs.top/img/2024/08/1000013055.webp" srcset="/img/loading.gif" lazyload alt="Wireshark é¦–é¡µ"></p><ol start="3"><li>é€‰ä¸­ <code>SSH remote capture:sshdump</code>ï¼Œç‚¹å‡»å®ƒçš„è®¾ç½®</li></ol><p><img src="https://cdn.jiecs.top/img/2024/08/1000013056.webp" srcset="/img/loading.gif" lazyload alt="æ•è·é€‰é¡¹"></p><ol start="4"><li>åœ¨ Server å’Œ Authentication é¡µé…ç½®è·¯ç”±å™¨çš„ SSH è¿æ¥ä¿¡æ¯ï¼Œå¹¶åœ¨ Capture é¡µä¸­è®¾ç½® Remote interface å’Œ Remote capture filter</li></ol><p><img src="https://cdn.jiecs.top/img/2024/08/1000013057.webp" srcset="/img/loading.gif" lazyload alt="æ¥å£é€‰é¡¹"></p><p>Remote interface å³æ‰€æŠ“åŒ…çš„ç½‘ç»œæ¥å£ï¼Œä¸»è¦å¯ä»¥ä¸ºï¼š</p><ul><li>ppp0 å³ IPv6 çš„æ¥å£</li><li>br0 å³å†…ç½‘æ¥å£</li></ul><p>å¯ä»¥é€šè¿‡ <code>ip a</code> æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£å’Œå¯¹åº”çš„ IP</p><p>Remote capture filter æ˜¯æ€»çš„è¿‡æ»¤å™¨ï¼Œå»ºè®®ç”¨ <code>not port [SSH_PORT]</code> è¿‡æ»¤æ‰ Wireshark å®¢æˆ·ç«¯è‡ªå·±æŠ“åŒ…çš„ SSH æ•°æ®</p><ol start="5"><li>ç„¶åå°±å¯ä»¥å…³æ‰è®¾ç½®å¼€å§‹æŠ“åŒ…äº†</li></ol><h3 id="ç”¨-iptables-LOG"><a href="#ç”¨-iptables-LOG" class="headerlink" title="ç”¨ iptables LOG"></a>ç”¨ iptables LOG</h3><p>iptables ä¸ä»…å¯ä»¥è®¾ç½® ACCEPTã€DROP ä¹‹ç±»çš„è§„åˆ™ï¼Œè¿˜å¯ä»¥è®¾ç½® jump åˆ° LOG</p><p>ä¾‹å¦‚ <code>ip6tables -I INPUT 1 -i ppp0 -m limit --limit 60/min -j LOG --log-prefix &quot;FROM-PPP0: &quot;</code> å³å¯å°†æ‰€æœ‰ç¬¦åˆè¯¥è§„åˆ™ï¼ˆä» ppp0 æ¥å£è¿›å…¥ï¼‰çš„æµé‡è®°å½•åˆ°æ—¥å¿—ä¸­</p><p>å…¶ä¸­ï¼š</p><ul><li><code>-m limit --limit 60/min</code> ç”¨äºé™åˆ¶è®°å½•æ—¥å¿—çš„é¢‘ç‡ï¼ŒåŒ…å¤ªå¤šè·¯ç”±å™¨å¾ˆå®¹æ˜“å¡æ­»</li><li><code>--log-prefix [str]</code> å³æ—¥å¿—å‰ç¼€</li></ul><div class="note note-light"><p>æ³¨æ„ iptables è§„åˆ™ä»ä¸Šå¾€ä¸‹åŒ¹é…ï¼Œç”¨ <code>-A</code> æ¥æ·»åŠ ä¼šæŠŠ LOG è§„åˆ™æ”¾åœ¨é“¾çš„æœ€åï¼Œå¦‚æœæ•°æ®åœ¨å‰é¢å°±å·²ç»è¢« DROP äº†é‚£å°±ä¸ä¼šè®°å½•ä¸‹æ¥ã€‚æ‰€ä»¥è¿™é‡Œç”¨ <code>-I [Chain] 1</code> æŒ‡å®šæ’å…¥åˆ°é“¾çš„ç¬¬ 1 ä½</p></div><p>å¯ä»¥é€šè¿‡ <code>dmesg | grep &quot;FROM-PPP0: &quot;</code> æ¥æŸ¥æ‰¾è®°å½•ä¸‹æ¥çš„æµé‡ï¼Œgrep å³ç”¨äºæŸ¥æ‰¾ log å‰ç¼€</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E7%AE%80%E5%8D%95%E6%8A%80%E6%9C%AF/" class="category-chain-item">ç®€å•æŠ€æœ¯</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%97%A5%E5%B8%B8/" class="print-no-link">#æ—¥å¸¸</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" class="print-no-link">#æŠ€æœ¯</a> <a href="/tags/%E6%95%99%E7%A8%8B/" class="print-no-link">#æ•™ç¨‹</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/archives/e023069a/" title="å„ç§è¿æ¥å™¨æ€»ç»“"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">å„ç§è¿æ¥å™¨æ€»ç»“</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/archives/90ab79b3/" title="Azure ä¸­é€šè¿‡è´Ÿè½½å‡è¡¡å™¨é›¶æˆæœ¬å¼€å¯ IPv6 æ”¯æŒ"><span class="hidden-mobile">Azure ä¸­é€šè¿‡è´Ÿè½½å‡è¡¡å™¨é›¶æˆæœ¬å¼€å¯ IPv6 æ”¯æŒ</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>ç›®å½•</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://unpkg.jiecs.top/mermaid@8.14.0/dist/mermaid.min.js",(function(){mermaid.initialize({theme:"default"}),Fluid.utils.listenDOMLoaded((function(){Fluid.events.registerRefreshCallback((function(){"mermaid"in window&&mermaid.init()}))}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="/follow" target="_blank" rel="nofollow noopener"><span>Follow</span></a> | <a href="/thanks" target="_blank" rel="nofollow noopener"><span>Thanks</span></a> | <a href="/privacy-policy" target="_blank" rel="nofollow noopener"><span>Privacy</span></a> | <a href="https://jiecs-status.betteruptime.com" target="_blank" rel="nofollow noopener"><span>Status</span></a><br>Jiecs All Rights Reserved</div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">æµ™ICPå¤‡2021024503å·</a></span></div></div></footer><script src="https://unpkg.jiecs.top/jquery@3.6.4/dist/jquery.min.js"></script><script src="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/tocbot@4.20.1/dist/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://unpkg.jiecs.top/clipboard@2.0.11/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/anchor-js@5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div></noscript><script src="/js/resize_image.js"></script><link rel="stylesheet" href="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.css"><link rel="stylesheet" href="/css/post_custom.css"><script src="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.umd.js"></script><script src="/js/post_custom.js"></script><script>if(!/jiecs.top|localhost/.test(location.host)){/google|bing|baidu|sogou|soso|DuckDuckBot|yandex|msn/i.test(navigator.userAgent)&&(location.host="www.jiecs.top")}</script><script defer async>if(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack||"",dnt.startsWith("1")||dnt.startsWith("yes")||dnt.startsWith("on")){var footer=document.querySelector("div.footer-content");footer.innerHTML=footer.innerHTML+"<br>I don't track ;)"}else{!function(t,e,a,n,o,r,c){t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},(r=e.createElement(n)).async=1,r.src="https://www.clarity.ms/tag/83h7yd1jzh",(c=e.getElementsByTagName(n)[0]).parentNode.insertBefore(r,c)}(window,document,"clarity","script");var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e2bcbf5019e3c05e7631d4a3081b10d9";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();let t=document.createElement("script");function gtag(){dataLayer.push(arguments)}t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8QKELED2GX",document.body.appendChild(t),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8QKELED2GX")}</script><script src="/js/custom.js"></script></body></html>