<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Jiecs"><meta name="keywords" content=""><meta name="description" content="å‰è¨€æ¯”èµ·å¾®ä¿¡ QQ é‚£ç§æ¯’ç˜¤ï¼ŒTelegram å·²æ˜¯é™ç»´æ‰“å‡»ã€‚ç„¶è€Œç°åœ¨ Telegram ä¹Ÿæ­£å˜å¾—è¶Šæ¥è¶Šå°é—­ï¼ŒåŠ å…¥äº†é¢‘é“å¹¿å‘Šè¿˜æœ‰ Telegram Premiumï¼Œå¯¹å…è´¹ç”¨æˆ·çš„é™åˆ¶è¶Šæ¥è¶Šå¤š æœ€å…³é”®çš„æ˜¯ Telegram çš„å¼€æºå¼€æ”¾ç¨‹åº¦ä¹Ÿåœ¨ä¸€ç‚¹ç‚¹åœ°é™ä½ï¼Œè€Œä¸” Telegram æœ¬èº«çš„ç«¯åˆ°ç«¯åŠ å¯†å¯¹è¯æ²¡æ³•äº‘åŒæ­¥ï¼Œç¾¤èŠé¢‘é“éƒ½ä¸æ”¯æŒï¼Œæ ¹æœ¬æ²¡æƒ³è®©ä½ æ—¥å¸¸ä½¿ç”¨ã€‚Telegram çš„æœåŠ¡å™¨ç«¯å¹¶ä¸å¼€æºï¼Œä»æŠ€æœ¯ä¸Šæ¥è¯´"><meta property="og:type" content="article"><meta property="og:title" content="åˆ«å†ç”¨ Telegram äº†ï¼å¿«æ¢åˆ°çœŸå¼€æºçš„ Martix â€” æ­å»º mautrix-telegram æ¡¥æ¥"><meta property="og:url" content="https://www.jiecs.top/archives/2a3d3c6c/index.html"><meta property="og:site_name" content="æ°å‡ºå…½çš„å°å®‡å®™"><meta property="og:description" content="å‰è¨€æ¯”èµ·å¾®ä¿¡ QQ é‚£ç§æ¯’ç˜¤ï¼ŒTelegram å·²æ˜¯é™ç»´æ‰“å‡»ã€‚ç„¶è€Œç°åœ¨ Telegram ä¹Ÿæ­£å˜å¾—è¶Šæ¥è¶Šå°é—­ï¼ŒåŠ å…¥äº†é¢‘é“å¹¿å‘Šè¿˜æœ‰ Telegram Premiumï¼Œå¯¹å…è´¹ç”¨æˆ·çš„é™åˆ¶è¶Šæ¥è¶Šå¤š æœ€å…³é”®çš„æ˜¯ Telegram çš„å¼€æºå¼€æ”¾ç¨‹åº¦ä¹Ÿåœ¨ä¸€ç‚¹ç‚¹åœ°é™ä½ï¼Œè€Œä¸” Telegram æœ¬èº«çš„ç«¯åˆ°ç«¯åŠ å¯†å¯¹è¯æ²¡æ³•äº‘åŒæ­¥ï¼Œç¾¤èŠé¢‘é“éƒ½ä¸æ”¯æŒï¼Œæ ¹æœ¬æ²¡æƒ³è®©ä½ æ—¥å¸¸ä½¿ç”¨ã€‚Telegram çš„æœåŠ¡å™¨ç«¯å¹¶ä¸å¼€æºï¼Œä»æŠ€æœ¯ä¸Šæ¥è¯´"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jiecs.top/img/2023/06/cover_%E5%88%AB%E5%86%8D%E7%94%A8Telegram%E4%BA%86%EF%BC%81%E5%BF%AB%E6%8D%A2%E5%88%B0%E7%9C%9F%E5%BC%80%E6%BA%90%E7%9A%84Martix.webp"><meta property="article:published_time" content="2023-06-23T11:06:02.000Z"><meta property="article:modified_time" content="2026-03-01T17:03:10.352Z"><meta property="article:author" content="Jiecs"><meta property="article:tag" content="Telegram"><meta property="article:tag" content="Web3"><meta property="article:tag" content="æ•™ç¨‹"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jiecs.top/img/2023/06/cover_%E5%88%AB%E5%86%8D%E7%94%A8Telegram%E4%BA%86%EF%BC%81%E5%BF%AB%E6%8D%A2%E5%88%B0%E7%9C%9F%E5%BC%80%E6%BA%90%E7%9A%84Martix.webp"><title>åˆ«å†ç”¨ Telegram äº†ï¼å¿«æ¢åˆ°çœŸå¼€æºçš„ Martix â€” æ­å»º mautrix-telegram æ¡¥æ¥ - æ°å‡ºå…½çš„å°å®‡å®™</title><link rel="stylesheet" href="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/hint.css@2.7.0/hint.min.css"><link rel="stylesheet" href="https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"www.jiecs.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["home"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 8.1.1"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body><style>footer{position:relative}.iframe-overlay,iframe[loading=lazy]{position:absolute;height:265px;width:300px;transform:scale(.9) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem);bottom:-100px;left:0;z-index:3;transition:transform .3s ease,clip-path .3s ease}.iframe-overlay{z-index:4;background:0 0;cursor:pointer;display:none}iframe[loading=lazy].expanded+.iframe-overlay{display:none}iframe[loading=lazy].expanded{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 0 0 0 round 1.2rem)}:root[data-user-color-scheme=light] iframe[loading=lazy]{filter:invert(1) hue-rotate(-200deg)}@media (max-width:1700px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 140px 0 round 1.2rem);transform:scale(.64)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(25px);clip-path:inset(0 round 1.2rem)}.iframe-overlay{display:block}}@media (max-width:768px){.iframe-overlay,iframe[loading=lazy]{clip-path:inset(0 0 183px 0 round 1.2rem);bottom:-38px;transform:scale(.5) scaleY(.93);left:calc(50% - 150px)}iframe[loading=lazy]:hover{transform:scale(1) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}iframe[loading=lazy].expanded{transform:scale(.8) scaleY(1) translateY(-120px) translateX(0);clip-path:inset(0 0 0 0 round 1.2rem)}}</style><script>document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector("footer"),t=document.createElement("iframe");t.frameBorder=0,t.src="https://support.nodeget.com/page/promotion?id=334%20|%20jiesou",t.loading="lazy";const n=document.createElement("div");n.className="iframe-overlay",n.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("expanded")})),e.appendChild(t),e.appendChild(n),document.addEventListener("click",(function(e){t.contains(e.target)||t.classList.remove("expanded")}))}))</script><header><div class="header-inner" style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>æ°å‡ºå…½çš„å°å®‡å®™</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>é¦–é¡µ</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/%E5%8A%A8%E6%80%81/" target="_self"><i class="iconfont icon-comment"></i> <span>åŠ¨æ€</span></a></li><li class="nav-item"><a class="nav-link" href="/projects/" target="_self"><i class="iconfont icon-code"></i> <span>é¡¹ç›®</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>å…³äº</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-link-fill"></i> <span>å‹é“¾</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="https://www.alongw.cn" target="_self"><span>é˜¿é¾™åšå®¢</span></a></div></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" false style="background:url(https://cdn.jiecs.top/img/2023/06/cover_åˆ«å†ç”¨Telegramäº†ï¼å¿«æ¢åˆ°çœŸå¼€æºçš„Martix.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">åˆ«å†ç”¨ Telegram äº†ï¼å¿«æ¢åˆ°çœŸå¼€æºçš„ Martix â€” æ­å»º mautrix-telegram æ¡¥æ¥</span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-06-23 11:06" pubdate>2023å¹´6æœˆ23æ—¥ ä¸Šåˆ</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.5k å­—</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">åˆ«å†ç”¨ Telegram äº†ï¼å¿«æ¢åˆ°çœŸå¼€æºçš„ Martix â€” æ­å»º mautrix-telegram æ¡¥æ¥</h1><div class="markdown-body"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¯”èµ·å¾®ä¿¡ QQ é‚£ç§æ¯’ç˜¤ï¼ŒTelegram å·²æ˜¯é™ç»´æ‰“å‡»ã€‚ç„¶è€Œç°åœ¨ Telegram ä¹Ÿæ­£å˜å¾—è¶Šæ¥è¶Šå°é—­ï¼ŒåŠ å…¥äº†é¢‘é“å¹¿å‘Šè¿˜æœ‰ Telegram Premiumï¼Œå¯¹å…è´¹ç”¨æˆ·çš„é™åˆ¶è¶Šæ¥è¶Šå¤š</p><p>æœ€å…³é”®çš„æ˜¯ Telegram çš„å¼€æºå¼€æ”¾ç¨‹åº¦ä¹Ÿåœ¨ä¸€ç‚¹ç‚¹åœ°é™ä½ï¼Œè€Œä¸” Telegram æœ¬èº«çš„ç«¯åˆ°ç«¯åŠ å¯†å¯¹è¯æ²¡æ³•äº‘åŒæ­¥ï¼Œç¾¤èŠé¢‘é“éƒ½ä¸æ”¯æŒï¼Œæ ¹æœ¬æ²¡æƒ³è®©ä½ æ—¥å¸¸ä½¿ç”¨ã€‚Telegram çš„æœåŠ¡å™¨ç«¯å¹¶ä¸å¼€æºï¼Œä»<em>æŠ€æœ¯ä¸Šæ¥è¯´</em> Telegram å¯¹ç”¨æˆ·çš„æ¶ˆæ¯æ˜¯æœ‰<strong>å®Œå…¨æŒæ§æƒ</strong>çš„ï¼Œä»–ä»¬æƒ³å¹²å˜›éƒ½å¯ä»¥ï¼Œä¸å¾®ä¿¡ QQ æ²¡æœ‰æœ¬è´¨åŒºåˆ«</p><p>æ›´ä½•å†µ Telegram å®¢æˆ·ç«¯çš„å¼€æºç¨‹åº¦æœ‰ä¸€ç‚¹ç‚¹çš„åœ¨é™ä½ï¼Œå¯¹ä¸‰æ–¹å®¢æˆ·ç«¯çš„é™åˆ¶è¶Šæ¥è¶Šå¤šã€‚åŒ…æ‹¬ä¸èƒ½æ³¨å†Œã€é™é€Ÿä¸‹è½½ä»¥åŠä¸¥æ ¼çš„é£æ§</p><p>è¿™ä¹Ÿæ­£å¯¼è‡´ä¸€äº›ä¸»æ‰“å»ä¸­å¿ƒåŒ–ã€å¼€æºå¼€æ”¾çš„å³æ—¶é€šè®¯è½¯ä»¶&#x2F;åè®®è¶Šæ¥è¶Šæ´»è·ƒèµ·æ¥ã€‚Matrix å°±æ˜¯ç›¸å¯¹çŸ¥åä¸”åŠŸèƒ½å®Œå–„çš„</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a target="_blank" rel="noopener" href="https://matrix.org/">Matrix</a> æœ¬èº«åªæ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–çš„é€šè®¯åè®®ï¼Œé€»è¾‘ç±»ä¼¼ç”µå­é‚®ç®±</p><p>ç”µå­é‚®ç®±ä¸­ä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„æœåŠ¡å•†ï¼šGmailã€QQé‚®ç®±ï¼Œè€Œåœ¨ Matrix ä¸­ä½ ä¹Ÿå¯ä»¥é€‰ä¸åŒçš„ Homeserverã€‚æ¯”å¦‚ä¸€ä¸ªå½¢ä¼¼ <code>@chen_this:matrix.org</code> çš„ç”¨æˆ·åä¸­ï¼Œ<code>:</code> åçš„åŸŸåå°±è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ‰€å±çš„ Homeserver</p><p>å°±åƒç”µå­é‚®ç®±ä¸­ä¸€æ ·ï¼Œ<strong>ä¸åŒ Homeserver</strong> ä¹‹é—´çš„æ¶ˆæ¯ä¹Ÿå¯ä»¥<strong>äº’é€š</strong>ï¼Œè€Œä¸”æ¯ä¸ª Homeserver æä¾›å•†éƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„è§„åˆ™ï¼Œç®¡ç†è‡ªå·±çš„ç”¨æˆ·ã€‚å³ä½¿æŸä¸ª Homeserver å®•æœºäº†ï¼Œä½¿ç”¨å…¶ä»– Homeserver çš„äººä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚è€Œä¸”åè®®æœ¬èº«ä¹Ÿæ²¡æ³•è¢«å¢™ä¹‹ç±»çš„</p><p>åŒæ ·ï¼Œå°±åƒç”µå­é‚®ç®±æœ¬èº«åªæ˜¯ä¸ªåè®®ï¼Œéœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Matrix ä¹Ÿ<strong>è¦ä¸€ä¸ªå®¢æˆ·ç«¯</strong>ã€‚ç°åœ¨æœ€ä¸ºæµè¡Œçš„å°±æ˜¯ <a target="_blank" rel="noopener" href="https://element.io/">Element</a>ï¼ˆä»¥å‰å« Riot.imï¼‰ã€‚ä¸‹è½½å®‰è£…ç›´æ¥æ³¨å†Œå³å¯ï¼Œæ³¨å†Œ Matrix è´¦æˆ·ä¸ç”¨æ‰‹æœºå·ï¼Œé€šå¸¸éœ€è¦ç”µå­é‚®ç®±ï¼Œå–å†³äº Homeserver çš„è®¾ç½®</p><p>Matrix å¯¹ç¾¤èŠå¯¹è¯çš„æ•°é‡é™åˆ¶å‡ ä¹æ²¡æœ‰ï¼Œæ¶ˆæ¯éƒ½æ˜¯äº‘åŒæ­¥ï¼Œèƒ½å‘é€è´´çº¸è¡¨æƒ…ã€å„ç§åª’ä½“ï¼Œä»€ä¹ˆæŠ•ç¥¨å®šä½æƒé™ç®¡ç†ä¸€åº”ä¿±å…¨ã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯å¤§å¤šæ•° Homeserver éƒ½åªå…è®¸ä½ ä¸Šä¼ å•ä¸ªæœ€å¤§ 100M&#x2F;200M çš„æ–‡ä»¶</p><h2 id="æ¡¥æ¥"><a href="#æ¡¥æ¥" class="headerlink" title="æ¡¥æ¥"></a>æ¡¥æ¥</h2><p>Matrix è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯èƒ½ä¸å…¶ä»–å³æ—¶é€šè®¯è½¯ä»¶æ¡¥æ¥ã€‚å°±åƒ Telegram æœ‰ EH Forwarder Botã€‚ç„¶è€Œ Telegram çš„ EFB ç¡®å®é—®é¢˜æŒºå¤šï¼Œç»å¸¸åŠ¨ä¸åŠ¨ç¦»çº¿</p><p>Matrix çš„å„ç§ Bridges èƒ½è®©ä½ å’Œ Telegramã€Discord ç”šè‡³å¾®ä¿¡ QQ æ¡¥æ¥ï¼Œç›´æ¥åœ¨ Matrix ä¸Šæ”¶å‘å…¶ä»–å¹³å°çš„æ¶ˆæ¯ï¼Œè€Œä¸”ä½“éªŒç›¸å½“æ— ç¼ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦è®²çš„å°±æ˜¯ <a target="_blank" rel="noopener" href="https://github.com/mautrix/telegram">mautrix-telegram</a>ï¼Œæ”¯æŒ Matrix - Telegram åŒå‘æ˜ å°„ï¼Œå½“ç„¶ä¸»è¦æ˜¯ Telegram to Matrix</p><h3 id="é¢„å¤‡æ¡ä»¶"><a href="#é¢„å¤‡æ¡ä»¶" class="headerlink" title="é¢„å¤‡æ¡ä»¶"></a>é¢„å¤‡æ¡ä»¶</h3><ul><li>æœåŠ¡å™¨</li><li>åŸŸå</li><li>åŸŸåçš„ SSL è¯ä¹¦</li></ul><p>ä¸åŒäº Telegram å¯ä»¥ç›´æ¥è°ƒç”¨ Core APIï¼Œç”±äº Matrix çš„å»ä¸­å¿ƒåŒ–ï¼Œè¦æƒ³åœ¨ Matrix ä¸Šå’Œåˆ«äººæ”¶å‘æ¶ˆæ¯ï¼Œä½ è¿˜<strong>éœ€è¦æ­å»ºè‡ªå·±çš„ Homeserver</strong></p><p>å½“ç„¶ Homeserver ä¹Ÿå¯ä»¥åœ¨ Docker ä¸­è¿è¡Œï¼Œä½†è¦æ­å»ºå®ƒä½ è¿˜éœ€è¦ä¸€ä¸ªåŸŸåã€‚æœ€å¥½æ˜¯äºŒçº§åŸŸåè€Œä¸æ˜¯ä¸‰çº§æˆ–ä»¥ä¸Šï¼ˆexample.com è€Œä¸æ˜¯ matrix.example.comï¼‰</p><p>è¿˜éœ€è¦æœ‰è¿™ä¸ªåŸŸåçš„ SSL è¯ä¹¦ï¼Œ<a target="_blank" rel="noopener" href="https://certbot.eff.org/">certbot</a> ç”³è¯·çš„ Letâ€™s Encrypt å³å¯ã€‚å®‰è£… certbot åè¿è¡Œ <code>sudo certbot certonly --standalone</code> å¹¶æ ¹æ®è¯´æ˜æ“ä½œ</p><h3 id="Docker-Compose-éƒ¨ç½²"><a href="#Docker-Compose-éƒ¨ç½²" class="headerlink" title="Docker Compose éƒ¨ç½²"></a>Docker Compose éƒ¨ç½²</h3><p>æ•´ä¸ªæ¡¥ä»¥åŠé…å¥—ç¯å¢ƒéƒ½å»ºè®®ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">Docker Compose</a> éƒ¨ç½²ï¼Œä¸€æ¡å‘½ä»¤å°±èƒ½å¼€å…³ï¼Œå®¹å™¨ä¸å¤–ç•Œéš”ç¦»ï¼Œä¸ç”¨æ‹…å¿ƒä¾èµ–ã€å…¼å®¹é—®é¢˜</p><h4 id="å¤§ä½“æµç¨‹"><a href="#å¤§ä½“æµç¨‹" class="headerlink" title="å¤§ä½“æµç¨‹"></a>å¤§ä½“æµç¨‹</h4><p>ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ®å®˜æ–¹é…ç½®è‡ªå·±å†™çš„ docker-compose.yamlï¼ŒæŠŠéœ€è¦çš„æœåŠ¡éƒ½æ‰åˆ°äº†ä¸€èµ·ï¼Œä¾›å‚è€ƒï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">synapse:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/matrixdotorg/synapse:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SYNAPSE_CONFIG_PATH=/data/homeserver.yaml</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./synapse:/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/letsencrypt:/etc/cert:ro</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8448</span><span class="hljs-string">:8448/tcp</span><br><br>  <span class="hljs-attr">mautrix-telegram:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dock.mau.dev/mautrix/telegram:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./mautrix-telegram:/data</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>  <br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/postgres:12-alpine</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_USER=matrix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=changeme</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_INITDB_ARGS=--encoding=UTF-8</span> <span class="hljs-string">--lc-collate=C</span> <span class="hljs-string">--lc-ctype=C</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./schemas:/var/lib/postgresql/data</span><br></code></pre></td></tr></table></figure><ol><li>åœ¨éœ€è¦çš„ä½ç½®<code>mkdir matrix-service</code> åˆ›å»ºæ–‡ä»¶å¤¹ç„¶åè¿›å…¥</li><li>åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»º <code>docker-compose.yaml</code> æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸Šé…ç½®ï¼Œä¿®æ”¹ POSTGRES_PASSWORD</li><li><code>docker compose up</code> é¦–æ¬¡è¿è¡Œç”Ÿæˆé…ç½®æ–‡ä»¶</li><li>è°ƒæ•´é…ç½®å <code>docker compose up -d</code> æŒç»­è¿è¡Œ</li></ol><p>ä»¥ä¸‹ä¸€ç‚¹ç‚¹è§£é‡Š</p><h4 id="Homeserver-Synapse"><a href="#Homeserver-Synapse" class="headerlink" title="Homeserver - Synapse"></a>Homeserver - Synapse</h4><p>Matrix ä½¿ç”¨æœ€å¹¿æ³›çš„ Homeserver å®ç°å°±æ˜¯ <a target="_blank" rel="noopener" href="https://github.com/matrix-org/synapse">Synapse</a>ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/matrix-org/synapse/blob/develop/contrib/docker/docker-compose.yml">å®˜æ–¹æä¾› docker-compose.yaml</a></p><p>è™½ç„¶ Synapse ä¹Ÿæ”¯æŒ SQLiteï¼Œä½†å»ºè®®æ— è®ºå¦‚ä½•éƒ½è¦ä½¿ç”¨ PostgreSQLã€‚è¿™ä¸ä¼šç¬¨é‡å¤šå°‘ï¼Œè€Œ SQLite åæœŸç»´æŠ¤èµ·æ¥ä¼šç›¸å½“éº»çƒ¦ï¼Œæ€§èƒ½ä¹Ÿå¾ˆå·®</p><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>é¦–æ¬¡è¿è¡Œç”Ÿæˆé…ç½®æ–‡ä»¶åï¼Œè¿›å…¥ <code>./synapse</code> ç›®å½•å³å¯çœ‹åˆ° <code>homeserver.yaml</code>ã€‚<a target="_blank" rel="noopener" href="https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html">é…ç½®æ–‡ä»¶æ–‡æ¡£</a></p><p>è¦æ·»åŠ &#x2F;ä¿®æ”¹çš„æœ‰è¿™ä¹ˆå‡ ä¸ª</p><h6 id="server-name"><a href="#server-name" class="headerlink" title="server_name"></a>server_name</h6><p>ç›´æ¥å¡«å†™ä½ çš„ Homeserver åŸŸå</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server_name:</span> <span class="hljs-string">&quot;example.com&quot;</span><br></code></pre></td></tr></table></figure><h6 id="listeners"><a href="#listeners" class="headerlink" title="listeners"></a>listeners</h6><p>å¡«å†™ç›‘å¬ç«¯å£</p><p>8448 å¯¹å¤–å¼€æ”¾ï¼Œå·²åœ¨ docker-compose.yaml ä¸­é…ç½®ç«¯å£æ˜ å°„ï¼Œå¦‚æœäº‘æœåŠ¡å™¨æœ‰<strong>é˜²ç«å¢™ä¹Ÿè¦å…è®¸</strong>ã€‚å…¶ä¸­ tls: true éœ€è¦ SSL è¯ä¹¦</p><p>8008 ä»…ç”¨äºå’Œ mautrix-telegram æ¡¥çš„å®¹å™¨å†…ç½‘æ²Ÿé€šï¼Œä¸å¿…å¯ç”¨ tls</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">listeners:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8448</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">resources:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-attr">names:</span> [<span class="hljs-string">client</span>, <span class="hljs-string">federation</span>]<br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8008</span><br>    <span class="hljs-attr">tls:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attr">x_forwarded:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">names:</span> [<span class="hljs-string">client</span>, <span class="hljs-string">federation</span>]<br>        <span class="hljs-attr">compress:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>è¦å¯ç”¨ tlsï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¯ä¹¦çš„ä½ç½®</p><p>certbot ç”³è¯·çš„è¯ä¹¦é»˜è®¤æ”¾åœ¨ &#x2F;etc&#x2F;letsencryptã€‚docker-compose.yaml ä¸­å·²å°† &#x2F;etc&#x2F;letsencrypt æ˜ å°„åˆ°å®¹å™¨å†…çš„ &#x2F;etc&#x2F;cert</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tls_certificate_path:</span> <span class="hljs-string">&quot;/etc/cert/live/example.com/fullchain.pem&quot;</span><br><span class="hljs-attr">tls_private_key_path:</span> <span class="hljs-string">&quot;/etc/cert/live/example.com/privkey.pem&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example.com è·¯å¾„ä¸­çš„è¯ä¹¦æ–‡ä»¶å®é™…ä¸Šæ˜¯å¯¹ &#x2F;etc&#x2F;letsencrypt&#x2F;archive çš„è½¯é“¾æ¥ã€‚æ‰€ä»¥å¿…é¡»å°†æ•´ä¸ª &#x2F;etc&#x2F;letsencrypt æ˜ å°„è¿‡å»ï¼Œè€Œä¸èƒ½åªæ˜ å°„å•ä¸ªåŸŸå</p></blockquote><h6 id="database"><a href="#database" class="headerlink" title="database"></a>database</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">database:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">psycopg2</span><br>  <span class="hljs-attr">args:</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">matrix</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">changeme</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-string">synapse</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5432</span><br>    <span class="hljs-attr">cp_min:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">cp_max:</span> <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>é…ç½®è¿æ¥åˆ° PostgreSQL çš„ä¿¡æ¯</p><p>å¯†ç éœ€è¦ä¸ docker-compose.yaml ä¸­ POSTGRES_PASSWORD ç›¸åŒ</p><p>ä¸€èˆ¬æ¥è®²ï¼Œdatabase <code>synapse</code> ä¸ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼Œå¯ä»¥åœ¨ç¼–è¾‘å¥½é…ç½®åç»Ÿä¸€åˆ›å»º</p><h6 id="app-service-config-files"><a href="#app-service-config-files" class="headerlink" title="app_service_config_files"></a>app_service_config_files</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">app_service_config_files:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/data/mautrix-telegram-registration.yaml</span><br></code></pre></td></tr></table></figure><p>ç”¨æ¥ç®¡ç† app_serviceã€‚å„ç§æ¡¥æ¥ç¨‹åºéƒ½å±äº app_serviceï¼Œéœ€è¦åœ¨è¿™é‡Œæ³¨å†Œé…ç½®ï¼Œè¯´æ˜è‡ªå·±éœ€è¦çš„ç”¨æˆ·åå’Œç®¡ç†æƒé™ç­‰ã€‚ä¾‹å¦‚ mautrix-telegram é»˜è®¤ bot ç”¨æˆ·åæ˜¯ @telegrambot:example.comï¼Œéœ€è¦ @**telegram:example.com çš„ç”¨æˆ·å</p><p>é¦–æ¬¡è¿è¡Œ mautrix-telegram åä¼šåœ¨ <code>./mautrix-telegram</code> ç›®å½•ä¸­ç”Ÿæˆ registration.yamlï¼Œéœ€è¦å°†å®ƒ<strong>å¤åˆ¶</strong>åˆ°æ­¤å¤„</p><blockquote><p>ä¿®æ”¹ mautrix-telegram çš„é…ç½®åï¼Œregistration.yaml å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å»ºè®®å…ˆä¿®æ”¹å…¶é…ç½®å†å¤åˆ¶æ³¨å†Œæ–‡ä»¶</p></blockquote><blockquote><p>æ³¨å†Œæ–‡ä»¶åªèƒ½å¤åˆ¶ï¼Œç§»åŠ¨ä¼šè¢«é‡æ–°ç”Ÿæˆ</p></blockquote><h4 id="Bridge-mautrix-telegram"><a href="#Bridge-mautrix-telegram" class="headerlink" title="Bridge - mautrix-telegram"></a>Bridge - mautrix-telegram</h4><p><a target="_blank" rel="noopener" href="https://docs.mau.fi/bridges/general/docker-setup.html?bridge=telegram">å®˜æ–¹éƒ¨ç½²æ–‡æ¡£</a></p><p>åŒæ ·ä¹Ÿæ”¯æŒ SQLiteï¼Œä½†å»ºè®® PostgreSQL</p><p>é¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆ config.yamlï¼Œå†æ¬¡è¿è¡Œç”Ÿæˆ registration.yaml</p><h5 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>èƒ½æ”¹çš„ä¸œè¥¿éå¸¸å¤šï¼Œè¦æ³¨æ„çš„æœ‰è¿™ä¹ˆå‡ ä¸ªï¼Œå…¶ä»–çš„æ ¹æ®å–œå¥½æ”¹å³å¯</p><h6 id="homeserver"><a href="#homeserver" class="headerlink" title="homeserver"></a>homeserver</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">homeserver:</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">http://synapse:8008</span><br>    <span class="hljs-attr">domain:</span> <span class="hljs-string">example.com</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <a target="_blank" rel="noopener" href="http://synapse/">http://synapse</a> è¿™ç±» URL æ˜¯ Docker å®¹å™¨é—´å†…ç½‘é€šè®¯çš„æ–¹å¼ï¼Œæ”¾åœ¨ä¸€ä¸ª Docker Compose ä¸­çš„å®¹å™¨å¯ä»¥ç›´æ¥è¿™ä¹ˆé€šè®¯</p><p>domain ç›´æ¥å¡« Homeserver çš„åŸŸåå³å¯ï¼Œæ²¡æœ‰æ”¹è¿‡ç«¯å£å°±ä¿æŒé»˜è®¤</p><h6 id="appservice"><a href="#appservice" class="headerlink" title="appservice"></a>appservice</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">appservice:</span><br>     <span class="hljs-attr">address:</span> <span class="hljs-string">http://mautrix-telegram:29317</span><br>     <span class="hljs-attr">database:</span> <span class="hljs-string">postgres://matrix:changeme@db/mautrix_telegram</span><br></code></pre></td></tr></table></figure><p>address ä¼šç”¨äºç”Ÿæˆ registration.yaml</p><p>database éƒ¨åˆ†å‚è€ƒ <a href="#database">Synapse çš„ database é…ç½®</a>ã€‚æ˜¯ URI å½¢å¼ã€‚æ³¨æ„ dbname ä¸æ”¯æŒä¸­åˆ’çº¿ï¼Œæ‰€ä»¥æ˜¯ <code>mautrix_telegram</code> è€Œä¸æ˜¯ <code>mautrix-telegram</code></p><h6 id="telegram"><a href="#telegram" class="headerlink" title="telegram"></a>telegram</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">telegram:</span><br>    <span class="hljs-attr">api_id:</span> <span class="hljs-number">12345</span><br>    <span class="hljs-attr">api_hash:</span> <span class="hljs-string">abcd</span><br>    <span class="hljs-attr">bot_token:</span> <span class="hljs-number">1234</span><span class="hljs-string">:abcd</span><br></code></pre></td></tr></table></figure><p>ä» <a target="_blank" rel="noopener" href="https://my.telegram.org/apps">https://my.telegram.org/apps</a> è·å– api_id å’Œ api_hash</p><p>bot_token ç”¨äºå°†é™Œç”Ÿ Matrix ç”¨æˆ·çš„æ¶ˆæ¯é€šè¿‡ relay bot è½¬å‘åˆ° Telegram å®ç°åŒå‘æ˜ å°„ï¼Œå¦‚æœåªæ˜¯ä¸ªäººä½¿ç”¨<strong>å¯ä»¥ä¸ç”¨å¡«å†™</strong>ã€‚å¯ä»¥ä» <a target="_blank" rel="noopener" href="https://t.me/BotFather">https://t.me/BotFather</a> ä¸­ç”³è¯·ä¸€ä¸ª botï¼Œè·å– bot_token</p><h4 id="æ•°æ®åº“åˆå§‹åŒ–"><a href="#æ•°æ®åº“åˆå§‹åŒ–" class="headerlink" title="æ•°æ®åº“åˆå§‹åŒ–"></a>æ•°æ®åº“åˆå§‹åŒ–</h4><p>å¦‚<a href="#database">å‰æ–‡</a>æ‰€è¨€ï¼Œé¦–æ¬¡è¿è¡Œæ—¶é€šå¸¸ä¸ä¼šåœ¨ PostgreSQL ä¸­è‡ªåŠ¨åˆ›å»º databaseï¼Œä½†æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è¿›å…¥å…¶å®ä¾‹æ¥åˆ›å»º</p><h5 id="1-è¿›å…¥å®ä¾‹ç¯å¢ƒ"><a href="#1-è¿›å…¥å®ä¾‹ç¯å¢ƒ" class="headerlink" title="1. è¿›å…¥å®ä¾‹ç¯å¢ƒ"></a>1. è¿›å…¥å®ä¾‹ç¯å¢ƒ</h5><p>å…ˆç¡®ä¿ docker compose æ­£åœ¨è¿è¡Œï¼Œä½¿ç”¨ <code>docker ps</code> æ¥æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><p>è¿™ä¸ª Docker Compose ä¸­ï¼ŒPostgreSQL çš„å®¹å™¨åé€šå¸¸ä¸º <code>matrix-service-db-1</code>ï¼ˆå–å†³äºä½ çš„å‘½åï¼‰</p><p>ç„¶åæ ¹æ®å®¹å™¨åè¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it matrix-service-db-1 bash<br></code></pre></td></tr></table></figure><p>è¿›å…¥å®ä¾‹ç¯å¢ƒ</p><h5 id="2-åˆ›å»º-database"><a href="#2-åˆ›å»º-database" class="headerlink" title="2. åˆ›å»º database"></a>2. åˆ›å»º database</h5><p>åœ¨å®ä¾‹ç¯å¢ƒä¸­è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">psql -U matrix<br></code></pre></td></tr></table></figure><p>è¿›å…¥ PostgreSQL å‘½ä»¤è¡Œã€‚-U å–å†³äº PostgreSQL çš„ç”¨æˆ·åï¼Œæˆ‘çš„ docker-compose.yaml é»˜è®¤å³ matrix</p><p>ç„¶åè¿è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE synapse;<br><span class="hljs-keyword">CREATE</span> DATABASE mautrix_telegram;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“</p><p>å¯ä»¥è¿è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> datname <span class="hljs-keyword">FROM</span> pg_database;<br></code></pre></td></tr></table></figure><p>æ¥æ£€æŸ¥æœ‰æ²¡æœ‰æ­£ç¡®åˆ›å»º</p><h5 id="3-å®Œæˆ"><a href="#3-å®Œæˆ" class="headerlink" title="3. å®Œæˆ"></a>3. å®Œæˆ</h5><p>ä¾æ¬¡è¾“å…¥ <code>\q</code> <code>exit</code> <code>exit</code> æ¥é€€å‡º</p><h4 id="ä¹‹åå¯åšçš„"><a href="#ä¹‹åå¯åšçš„" class="headerlink" title="ä¹‹åå¯åšçš„"></a>ä¹‹åå¯åšçš„</h4><p>é…ç½®å®Œä¸€åˆ‡ä¹‹åè¿è¡Œ <code>docker compose up -d</code> æ¥æŒç»­è¿è¡Œï¼Œ-d ç”¨äºæ–­å¼€ä¸ä¼šè¯çš„è¿æ¥ï¼ˆåœ¨åå°è¿è¡Œï¼‰</p><p>ä½¿ç”¨ <code>docker compose logs --tails 20</code> æ¥æ£€æŸ¥å®ƒæœ‰æ²¡æœ‰æ­£å¸¸è¿è¡Œï¼Œâ€“tails 20 ç”¨æ¥é™åˆ¶è¾“å‡ºçš„é•¿åº¦</p><p>ç„¶åæ‰“å¼€ä½ çš„ Matrix å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ Elementã€‚æ ¹æ®ä½ çš„ Homeserver åŸŸåæœç´¢ <code>@telegrambot:example.com</code>ï¼Œbot åº”è¯¥ä¼šå‘é€ä¸€æ¡æ¬¢è¿æ¶ˆæ¯</p><p><em>Hello, Iâ€™m a Telegram bridge bot.<br>Use <code>help</code> for help or <code>login</code> to log in.</em></p><p>æ­å–œä½ æˆåŠŸéƒ¨ç½² mautrix-telegram ğŸ‰</p><p>telegrambot çš„ä½¿ç”¨å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://docs.mau.fi/bridges/python/telegram/authentication.html">æ–‡æ¡£</a></p><h4 id="åœ¨è‡ªå·±çš„-Homeserver-ä¸Šæ³¨å†Œç”¨æˆ·"><a href="#åœ¨è‡ªå·±çš„-Homeserver-ä¸Šæ³¨å†Œç”¨æˆ·" class="headerlink" title="åœ¨è‡ªå·±çš„ Homeserver ä¸Šæ³¨å†Œç”¨æˆ·"></a>åœ¨è‡ªå·±çš„ Homeserver ä¸Šæ³¨å†Œç”¨æˆ·</h4><p>ä½ å¯ä»¥åœ¨è‡ªå·±çš„ Homeserver ä¸Šåˆ›å»ºä¸€ä¸ªç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥åƒ matrix.org ä¸€æ ·å’Œå…¶ä»–ç”¨æˆ·æ”¶å‘æ¶ˆæ¯ã€‚ä¹Ÿå¯ä»¥ç®¡ç† Homeserverã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://matrix-org.github.io/synapse/latest/setup/installation.html#registering-a-user">æ–‡æ¡£</a></p><p>æ ¹æ®å®¹å™¨åè¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it matrix-service-synapse-1 register_new_matrix_user<br></code></pre></td></tr></table></figure><p>å³å¯åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ³¨å†Œï¼Œæ ¹æ®è¯´æ˜æ“ä½œå³å¯</p><p>æ³¨å†ŒååŒæ ·é€šè¿‡å®¢æˆ·ç«¯æ¥ç™»å½•ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯å½“ä¸­è·å–è®¿é—®ä»¤ç‰Œï¼Œç®¡ç†ç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—®ä»¤ç‰Œæ¥è®¿é—® <a target="_blank" rel="noopener" href="https://matrix-org.github.io/synapse/latest/usage/administration/admin_api/index.html">Admin API</a></p><h4 id="é…ç½®å®šæ—¶æ¸…ç†è„šæœ¬"><a href="#é…ç½®å®šæ—¶æ¸…ç†è„šæœ¬" class="headerlink" title="é…ç½®å®šæ—¶æ¸…ç†è„šæœ¬"></a>é…ç½®å®šæ—¶æ¸…ç†è„šæœ¬</h4><p>Matrix Homeserver ä¼šæ‰¿è½½ç”¨æˆ·å‘é€çš„æ‰€æœ‰èŠå¤©è®°å½•ã€åª’ä½“æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ .&#x2F;synapse&#x2F;media_store æ²¡è¿‡å‡ å¤©å°±ä¼šå å‡ å Gã€‚Synapse æä¾›ä¸€ä¸ª Admin API å¯ä»¥åˆ é™¤ç®¡ç†è¿™äº›åª’ä½“ã€‚<a target="_blank" rel="noopener" href="https://matrix-org.github.io/synapse/latest/admin_api/media_admin_api.html">å‚è€ƒæ–‡æ¡£</a></p><p>åª’ä½“åˆ†æœ¬åœ°å’Œè¿œç¨‹åª’ä½“ã€‚è¿œç¨‹åª’ä½“æ˜¯æŒ‡åœ¨å…¶ä»– Homeserver ä¸Šä¹Ÿå­˜åœ¨è¿™äº›åª’ä½“ï¼Œå¯ä»¥ç›´æ¥åˆ ã€‚æœ¬åœ°åª’ä½“å¦‚æœåˆ äº†å°±æ²¡äº†</p><p>æˆ‘å®šæ—¶æ‰§è¡Œè¿™ä¸²å‘½ä»¤æ¥æ¸…ç†è¿‡æ—¶åª’ä½“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">auth_token=&quot;syt_admin_auth_token&quot;<br>api_endpoint=&quot;http://localhost:8008/_synapse/admin/v1&quot;<br>before_ts=$(date -d &#x27;12 hours ago&#x27; +%s000)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">delete old <span class="hljs-built_in">local</span> media</span><br>docker exec matrix-service-synapse-1 \<br>  curl --header &quot;Authorization: Bearer $auth_token&quot; \<br>  -X POST &quot;$api_endpoint/media/delete?before_ts=$before_ts&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">delete old remote media</span><br>docker exec matrix-service-synapse-1 \<br>  curl --header &quot;Authorization: Bearer $auth_token&quot; \<br>  -X POST &quot;$api_endpoint/purge_media_cache?before_ts=$before_ts&quot;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªèƒ½ä½¿ç”¨å®˜æ–¹çš„ API æˆ–è€…ä¸€äº›ä¸“ç”¨æ¸…ç†å·¥å…·æ¥æ¸…ç†ã€‚æ— è®ºå¦‚ä½•ä½ éƒ½å°½é‡<strong>ä¸è¦åˆ é™¤æ•°æ®åº“</strong>ï¼Œé™¤éä½ çœŸçš„å†ä¹Ÿä¸æƒ³ç”¨äº†</p><p>ç”±äº Matrix çš„å»ä¸­å¿ƒåŒ–ï¼Œå³ä½¿ä½ å°†æœ¬åœ°æ•°æ®åº“åˆ äº†ï¼Œåœ¨å…¶ä»– Homeserver ä¸Šä»ç„¶ä¼šå­˜åœ¨å¾ˆå¤šä¿¡æ¯ã€‚ä½ çš„æ•°æ®åº“å’Œå…¶ä»–çš„å¯¹ä¸ä¸Šï¼Œå°±ä¼šå¯¼è‡´æ›´å¤šé—®é¢˜ã€‚é€šå¸¸ä½ è¦æŠŠå…¶ä»– Homeserver ä¸Šå­˜åœ¨çš„ä¼šè¯è®°å½•ä¹Ÿä¸€å¹¶åˆ æ‰æ‰è¡Œã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://matrix-org.github.io/synapse/latest/usage/administration/admin_faq.html#i-have-a-problem-with-my-server-can-i-just-delete-my-database-and-start-again">æ–‡æ¡£</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E7%AE%80%E5%8D%95%E6%95%99%E7%A8%8B/" class="category-chain-item">ç®€å•æ•™ç¨‹</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%95%99%E7%A8%8B/" class="print-no-link">#æ•™ç¨‹</a> <a href="/tags/Telegram/" class="print-no-link">#Telegram</a> <a href="/tags/Web3/" class="print-no-link">#Web3</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/archives/f9d2abb9/" title="LSOCP Minecraft æ•´åˆåŒ…å‡çº§è‡³æœ€æ–° 1.20.1 - è¶³è¿¹ä¸æ•…äº‹"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">LSOCP Minecraft æ•´åˆåŒ…å‡çº§è‡³æœ€æ–° 1.20.1 - è¶³è¿¹ä¸æ•…äº‹</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/archives/9cfeac56/" title="åŠ å¯†è´§å¸äº¤æ˜“ - ä½ è¦çŸ¥é“çš„ä¸€åˆ‡"><span class="hidden-mobile">åŠ å¯†è´§å¸äº¤æ˜“ - ä½ è¦çŸ¥é“çš„ä¸€åˆ‡</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>ç›®å½•</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="/follow" target="_blank" rel="nofollow noopener"><span>Follow</span></a> | <a href="/thanks" target="_blank" rel="nofollow noopener"><span>Thanks</span></a> | <a href="/privacy-policy" target="_blank" rel="nofollow noopener"><span>Privacy</span></a> | <a href="https://jiecs-status.betteruptime.com" target="_blank" rel="nofollow noopener"><span>Status</span></a><br>Jiecs All Rights Reserved</div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">æµ™ICPå¤‡2021024503å·</a></span></div></div></footer><script src="https://unpkg.jiecs.top/jquery@3.6.4/dist/jquery.min.js"></script><script src="https://unpkg.jiecs.top/bootstrap@4.6.1/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/tocbot@4.20.1/dist/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://unpkg.jiecs.top/clipboard@2.0.11/dist/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/anchor-js@5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://unpkg.jiecs.top/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div></noscript><script src="/js/resize_image.js"></script><link rel="stylesheet" href="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.css"><link rel="stylesheet" href="/css/post_custom.css"><script src="https://unpkg.jiecs.top/@waline/client@3.6.0/dist/waline.umd.js"></script><script src="/js/post_custom.js"></script><script>if(!/jiecs.top|localhost/.test(location.host)){/google|bing|baidu|sogou|soso|DuckDuckBot|yandex|msn/i.test(navigator.userAgent)&&(location.host="www.jiecs.top")}</script><script defer async>if(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack||"",dnt.startsWith("1")||dnt.startsWith("yes")||dnt.startsWith("on")){var footer=document.querySelector("div.footer-content");footer.innerHTML=footer.innerHTML+"<br>I don't track ;)"}else{!function(t,e,a,n,o,r,c){t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},(r=e.createElement(n)).async=1,r.src="https://www.clarity.ms/tag/83h7yd1jzh",(c=e.getElementsByTagName(n)[0]).parentNode.insertBefore(r,c)}(window,document,"clarity","script");var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e2bcbf5019e3c05e7631d4a3081b10d9";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();let t=document.createElement("script");function gtag(){dataLayer.push(arguments)}t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8QKELED2GX",document.body.appendChild(t),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8QKELED2GX")}</script><script src="/js/custom.js"></script></body></html>